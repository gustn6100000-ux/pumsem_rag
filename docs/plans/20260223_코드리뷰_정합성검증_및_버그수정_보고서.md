# 20260223 ì½”ë“œë¦¬ë·° ì •í•©ì„± ê²€ì¦ ë° ë²„ê·¸ ìˆ˜ì • ë³´ê³ ì„œ

> **ì‘ì„±ì¼**: 2026-02-23 11:00  
> **ì‘ì„±ì**: Antigravity AI Architect  
> **ëŒ€ìƒ**: Phase 4 / Phase 1.5-C / Phase 2 êµ¬í˜„ ìƒì„¸ ê¸°ë¡ì„œ 3ê±´ì— ëŒ€í•œ ì½”ë“œ ë¦¬ë·° ê²€ì¦ ë° í›„ì† ì¡°ì¹˜  
> **ê²°ê³¼**: âœ… ê·¼ë³¸ ì›ì¸ ê·œëª… â†’ ë²„ê·¸ 1ê±´ ìˆ˜ì • â†’ êµ¬ë²„ì „ ë””ë ‰í† ë¦¬ ì‚­ì œ â†’ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì •ì • â†’ DB ë°ì´í„° ê°±ì‹  ì™„ë£Œ

---

## 1. ë°œë‹¨: ì™¸ë¶€ ì½”ë“œ ë¦¬ë·°ì—ì„œ "ë¯¸êµ¬í˜„" íŒì •

### 1.1 ìµœì´ˆ ê²€í† ë³´ê³ ì„œ (Codex CLI ì‘ì„±)

êµ¬í˜„ ìƒì„¸ ê¸°ë¡ì„œ 3ê±´ì— ëŒ€í•´ Codex CLIê°€ ì½”ë“œ ì •í•©ì„± ê²€í† ë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼, ì•„ë˜ì™€ ê°™ì´ **ê³¼ë„í•˜ê²Œ ë¶€ì •ì ì¸ íŒì •**ì´ ë‚´ë ¤ì¡ŒìŠµë‹ˆë‹¤:

| Phase | Codex íŒì • | ìš”ì•½ |
|---|---|---|
| Phase 2 | **"ë¯¸êµ¬í˜„ ë˜ëŠ” ë§¤ìš° ì œí•œì "** | `classifyComplexity`, `generateReasoningGuide`, Route 3.5, íƒ€ì… í™•ì¥ ëª¨ë‘ ë¶€ì¬ |
| Phase 4 | **"40~50% êµ¬í˜„"** | `graph.ts`ê°€ v1 RPC ì‚¬ìš©, ë§¤íŠ¸ë¦­ìŠ¤ ì¶œë ¥ ìœ ì§€, `skipRegex` ë¯¸í™•ì¸ |
| Phase 1.5-C | **"60~70% êµ¬í˜„"** | ì§ì¢… ëˆ„ë½, `joint_type` ì¬ì‚¬ìš©, ì ˆëŒ€ ê²½ë¡œ |

---

## 2. ê·¼ë³¸ ì›ì¸ ê·œëª…: ê²€í†  ë””ë ‰í† ë¦¬ ì˜¤ì§€ì •

### 2.1 í”„ë¡œì íŠ¸ êµ¬ì¡° ë¬¸ì œ

ê²€í† ì(Codex CLI)ê°€ ì°¸ì¡°í•œ **`edge-function/`** ë””ë ‰í† ë¦¬ëŠ” ì´ˆê¸° ê°œë°œ ì‹œ ì‚¬ìš©í–ˆë˜ **êµ¬ë²„ì „ ì‚¬ë³¸**ì´ì—ˆìœ¼ë©°, ì‹¤ì œ ë°°í¬Â·ìš´ì˜ ì½”ë“œëŠ” **`supabase/functions/rag-chat/`** ë””ë ‰í† ë¦¬ì— ìˆì—ˆìŠµë‹ˆë‹¤:

```
í”„ë¡œì íŠ¸ ë£¨íŠ¸/
â”œâ”€â”€ edge-function/                    â† âŒ êµ¬ë²„ì „ ì‚¬ë³¸ (2/15~2/22 íƒ€ì„ìŠ¤íƒ¬í”„)
â”‚   â”œâ”€â”€ index.ts                      â† Phase 4/2 ë³€ê²½ì‚¬í•­ ë¯¸ë°˜ì˜
â”‚   â”œâ”€â”€ llm.ts                        â† generateReasoningGuide ì—†ìŒ
â”‚   â”œâ”€â”€ clarify.ts                    â† classifyComplexity ì—†ìŒ
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ supabase/functions/rag-chat/      â† âœ… ì‹¤ì œ ë°°í¬ ë””ë ‰í† ë¦¬ (2/23 íƒ€ì„ìŠ¤íƒ¬í”„)
    â”œâ”€â”€ index.ts                      â† Route 3.5 + ë°¸ë¸Œ íŠ¸ë¦¬ê±° í¬í•¨
    â”œâ”€â”€ llm.ts                        â† generateReasoningGuide í¬í•¨
    â”œâ”€â”€ clarify.ts                    â† classifyComplexity í¬í•¨
    â””â”€â”€ ...
```

### 2.2 íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ (ê²°ì •ì  ì¦ê±°)

| íŒŒì¼ | `edge-function/` (êµ¬ë²„ì „) | `supabase/functions/rag-chat/` (ë°°í¬) |
|---|---|---|
| `index.ts` | 2/22 23:26 | **2/23 09:56** |
| `llm.ts` | 2/21 10:50 | **2/23 09:55** |
| `clarify.ts` | 2/19 01:24 | **2/23 09:27** |
| `types.ts` | 2/15 22:19 | **2/23 09:27** |
| `graph.ts` | 2/15 23:52 | **2/23 08:53** |
| `resolve.ts` | 2/23 00:41 | **2/23 08:55** |

### 2.3 grep ì „ìˆ˜ ê²€ì¦ ê²°ê³¼

`supabase/functions/rag-chat/` ë””ë ‰í† ë¦¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ **grep ê²€ìƒ‰**ì„ ìˆ˜í–‰í•œ ê²°ê³¼, **ëª¨ë“  ê¸°ëŠ¥ì´ ì¡´ì¬**í•¨ì„ í™•ì¸:

| ê¸°ëŠ¥ | ê²€ìƒ‰ ê²°ê³¼ | íŒŒì¼:í–‰ë²ˆí˜¸ |
|---|---|---|
| `classifyComplexity` | âœ… ì¡´ì¬ | `clarify.ts:34` |
| `generateReasoningGuide` | âœ… ì¡´ì¬ | `llm.ts:190` |
| Route 3.5 | âœ… ì¡´ì¬ | `index.ts:1147` |
| `complex_estimate` | âœ… ì¡´ì¬ | `types.ts:105` |
| `complexity` í•„ë“œ | âœ… ì¡´ì¬ | `types.ts:112` |
| `get_related_resources_v2` | âœ… ì¡´ì¬ | `graph.ts:20,54` |
| `renderFlatTable` | âœ… ì¡´ì¬ | `index.ts:54,153,159,165` |
| `skipRegex` | âœ… ì¡´ì¬ | `resolve.ts:685,744` |
| ë°¸ë¸Œ íŠ¸ë¦¬ê±° `13-3-1` | âœ… ì¡´ì¬ | `index.ts:743` |

**ê²°ë¡ **: Codexì˜ Phase 2 "ë¯¸êµ¬í˜„" ë° Phase 4 "40~50%" íŒì •ì€ **ì „ë©´ ì˜¤ë¥˜**.

---

## 3. Claude ì½”ë“œ ë¦¬ë·°: ìœ íš¨í•œ ë²„ê·¸ 1ê±´ ë°œê²¬

### 3.1 Claudeì˜ ê²€í†  ê²°ê³¼

ClaudeëŠ” ì˜¬ë°”ë¥¸ ë””ë ‰í† ë¦¬(`supabase/functions/rag-chat/`)ë¥¼ ê²€í† í•˜ì—¬ **ì •í™•í•œ ë¶„ì„**ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤:

| Phase | Claude íŒì • |
|---|---|
| Phase 4 | âœ… 5/5 ì™„ì „ êµ¬í˜„ |
| Phase 1.5-C | âœ… 4/4 êµ¬í˜„ (ë°©ì‹ ì°¨ì´ëŠ” ìˆìœ¼ë‚˜ ê¸°ëŠ¥ ì •ìƒ) |
| Phase 2 | âš ï¸ **6/7** â€” Route 3.5 Dead Code ë²„ê·¸ 1ê±´ |

### 3.2 ë°œê²¬ëœ ë²„ê·¸: Route 3.5 Dead Code

**ì›ì¸**: `classifyComplexity()` í•¨ìˆ˜ê°€ `clarify.ts`ì— ì •ì˜ë˜ì–´ ìˆìœ¼ë‚˜, `index.ts`ì—ì„œ **importë˜ì§€ ì•Šê³  í˜¸ì¶œë˜ì§€ ì•Šì•„** `analysis.complexity`ê°€ í•­ìƒ `undefined`ë¡œ ë‚¨ì•„ Route 3.5 ì¡°ê±´ì´ ì ˆëŒ€ ì¶©ì¡±ë˜ì§€ ì•ŠëŠ” ìƒíƒœì˜€ìŠµë‹ˆë‹¤.

```typescript
// index.ts L36-42 â€” import ëª©ë¡ì— classifyComplexity ëˆ„ë½
import {
    analyzeIntent,
    detectCostIntent,
    extractSpec,
    graphClarify,
    normalizeSpec,
    // classifyComplexity â† ëˆ„ë½!
} from "./clarify.ts";

// index.ts L1051-1053 â€” í˜¸ì¶œë„ ëˆ„ë½
const analysis = await analyzeIntent(question, history, sessionContext);
// analysis.complexity = classifyComplexity(question, analysis); â† ì´ ì¤„ ì—†ìŒ!
analysis.spec = normalizeSpec(analysis.spec);
```

**ì˜í–¥**: `generateReasoningGuide()`(deepseek-reasoner) í˜¸ì¶œ ë¶ˆê°€. ë³µí•© ì§ˆì˜ê°€ Route 3.5ë¥¼ ìš°íšŒí•˜ì—¬ Route 4ë¡œ ì§í–‰.

---

## 4. ìˆ˜í–‰í•œ ì¡°ì¹˜ (ì´ 3ê±´ ì»¤ë°‹)

### 4.1 ì»¤ë°‹ 1: Route 3.5 Dead Code ë²„ê·¸ ìˆ˜ì • (`f9d76aa`)

```diff
 import {
     analyzeIntent,
     detectCostIntent,
     extractSpec,
     graphClarify,
     normalizeSpec,
+    classifyComplexity,
 } from "./clarify.ts";

 // Route 3: ì˜ë„ ë¶„ì„
 const analysis = await analyzeIntent(question, history, sessionContext);
+analysis.complexity = classifyComplexity(question, analysis);
 analysis.spec = normalizeSpec(analysis.spec);
```

- **ëŒ€ìƒ íŒŒì¼**: `supabase/functions/rag-chat/index.ts`
- **ë³€ê²½**: 2ì¤„ ì¶”ê°€ (import 1ì¤„ + í˜¸ì¶œ 1ì¤„)
- **íš¨ê³¼**: Route 3.5ê°€ ì •ìƒ ì‘ë™í•˜ì—¬ ë³µì¡ë„ 4ì  ì´ìƒ ì§ˆì˜ ì‹œ `deepseek-reasoner` ë§ˆìŠ¤í„°í”Œëœ ìƒì„±
- **ì¬ë°°í¬**: `supabase functions deploy rag-chat --project-ref bfomacoarwtqzjfxszdr` ì™„ë£Œ

### 4.2 ì»¤ë°‹ 2: íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ ì •ì • (`8599b2a`)

#### `parse_13_3_1.py` â€” ìˆ˜ëŸ‰ ë‹¨ìœ„ ìˆ˜ì •

```diff
-'quantity_unit': 'ê°œì†Œ',
+'quantity_unit': 'ì¸/ê°œì†Œ',
```

> **ì§ì¢… 3ê°œ â†’ 2ê°œ ì´ìŠˆ ê²€í†  ê²°ê³¼**: ì›ë³¸ í’ˆì…ˆ í…Œì´ë¸”(13-3-1 ë°¸ë¸Œ ì„¤ì¹˜)ì˜ HTMLì„ ì§ì ‘ íŒŒì‹±í•˜ì—¬ í™•ì¸í•œ ê²°ê³¼, í•´ë‹¹ í‘œì—ëŠ” **'í”ŒëœíŠ¸ë°°ê´€ê³µ'ê³¼ 'íŠ¹ë³„ì¸ë¶€' 2ê°œ ì§ì¢…ë§Œ ì¡´ì¬**í•©ë‹ˆë‹¤. Claudeì˜ "3ì§ì¢…" ì§€ì ì€ ì›ë³¸ ë°ì´í„°ì— ëŒ€í•œ ì˜¤í•´ì˜€ìœ¼ë©°, í˜„ì¬ íŒŒì„œì˜ 2ì§ì¢… êµ¬í˜„ì´ ì •í™•í•©ë‹ˆë‹¤.

#### `seed_db.py` â€” ê²½ë¡œ í•˜ë“œì½”ë”© ì œê±°

```diff
-from dotenv import load_dotenv
-load_dotenv('g:/My Drive/Antigravity/pipeline/.env')
+from dotenv import load_dotenv
+
+# ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ í´ë”(pipeline)ì˜ .env ë¡œë“œ
+SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
+PIPELINE_DIR = os.path.dirname(SCRIPT_DIR)
+load_dotenv(os.path.join(PIPELINE_DIR, '.env'))

-files_to_seed = ['g:/My Drive/.../records_13_1_1.json', ...]
+files_to_seed = [
+    os.path.join(SCRIPT_DIR, 'records_13_1_1.json'),
+    os.path.join(SCRIPT_DIR, 'records_13_3_1.json')
+]
```

- **íš¨ê³¼**: ë‹¤ë¥¸ PCÂ·CI í™˜ê²½ì—ì„œë„ ì¬í˜„ ê°€ëŠ¥

#### DB ë°ì´í„° ê°±ì‹ 

ìˆ˜ì •ëœ íŒŒì„œë¡œ `records_13_3_1.json`ì„ ì¬ìƒì„±(630ê±´) í›„ `seed_db.py` UPSERT ì‹¤í–‰ìœ¼ë¡œ DB ë°˜ì˜ ì™„ë£Œ:

```
Loading records_13_1_1.json... Batch 1~8 Success (HTTP 200)
Loading records_13_3_1.json... Batch 1~7 Success (HTTP 200)
Finished seeding 630 records.
```

### 4.3 ì»¤ë°‹ 3: êµ¬ë²„ì „ `edge-function/` ë””ë ‰í† ë¦¬ ì‚­ì œ (`38fb40f`)

```
git rm -r edge-function/
â†’ 10 files deleted (clarify.ts, config.ts, context.ts, embedding.ts,
   graph.ts, index.ts, llm.ts, resolve.ts, search.ts, types.ts)
```

- **ëª©ì **: í–¥í›„ ì½”ë“œ ë¦¬ë·° ì‹œ êµ¬ë²„ì „ ì½”ë“œì™€ í˜¼ë™ë˜ëŠ” ì‚¬íƒœë¥¼ ì›ì²œ ì°¨ë‹¨
- **ì˜í–¥**: ì—†ìŒ (ë°°í¬ëŠ” `supabase/functions/rag-chat/`ë§Œ ì‚¬ìš©)

---

## 5. Codexì˜ "ê¹ƒ ë³€ê²½ ì™„ë£Œ" ì£¼ì¥ ê²€ì¦

### 5.1 Codex ì£¼ì¥

CodexëŠ” ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì»¤ë°‹(`c169cd6`)í–ˆë‹¤ê³  ë³´ê³ :
1. `edge-function/` â†’ `_deprecated_edge-function/`ë¡œ ë¦¬ë„¤ì„
2. `parse_13_3_1.py` 3ì§ì¢… ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ ì²˜ë¦¬ ìˆ˜ì •
3. `seed_db.py` ì ˆëŒ€ ê²½ë¡œ ì œê±°

### 5.2 ê²€ì¦ ê²°ê³¼: **í•´ë‹¹ ì»¤ë°‹ ì—†ìŒ (ê°€ì§œ)**

```
$ git log --oneline -n 5
8c81e41 (HEAD -> main, origin/main) feat: Phase 4 + Phase 1.5-C + Phase 2 êµ¬í˜„ ì™„ë£Œ
f1d5319 style: Expand selector checkbox list height up to 60vh
d23167d style: Maximize chatbot layout dynamically to 96% screen width
```

- `c169cd6` ì»¤ë°‹ì€ ë¡œì»¬Â·ë¦¬ëª¨íŠ¸ ì–´ë””ì—ë„ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- `_deprecated_edge-function/` ë””ë ‰í† ë¦¬ëŠ” NOT FOUND
- `edge-function/` ë””ë ‰í† ë¦¬ëŠ” ì›ë˜ ì´ë¦„ ê·¸ëŒ€ë¡œ ì¡´ì¬

**íŒì •**: Codexê°€ ìƒŒë“œë°•ìŠ¤/ê²©ë¦¬ í™˜ê²½ì—ì„œ ì‘ì—…í–ˆê±°ë‚˜, ì‹¤í–‰ ê²°ê³¼ë¥¼ í™˜ê°(Hallucination)í•œ ê²ƒìœ¼ë¡œ ì¶”ì •. **ì‹¤ì œ ë¦¬í¬ì—ëŠ” ë¯¸ë°˜ì˜**.

---

## 6. ìµœì¢… Git ë¡œê·¸ (ì»¤ë°‹ ì´ë ¥)

```
38fb40f (HEAD -> main, origin/main) chore: remove stale edge-function directory
8599b2a fix: cleanup pipeline scripts (relative paths & quantity unit fix)
f9d76aa fix: resolve Route 3.5 dead code bug by calling classifyComplexity in index.ts
8c81e41 feat: Phase 4 + Phase 1.5-C + Phase 2 êµ¬í˜„ ì™„ë£Œ
f1d5319 style: Expand selector checkbox list height up to 60vh
```

---

## 7. ì •ì •ëœ Phaseë³„ ìµœì¢… íŒì •

| Phase | ìµœì´ˆ Codex íŒì • | Claude ì¬ê²€ì¦ | ìˆ˜ì • í›„ ìµœì¢… |
|---|---|---|---|
| Phase 4 | "40~50%" (ì˜¤ë¥˜) | âœ… 5/5 ì™„ì „ êµ¬í˜„ | âœ… **100%** |
| Phase 1.5-C | "60~70%" (ê³¼ì†Œí‰ê°€) | âœ… 4/4 êµ¬í˜„ | âœ… **100%** (quantity_unit ì •ì • ì™„ë£Œ) |
| Phase 2 | "ë¯¸êµ¬í˜„" (ì˜¤ë¥˜) | âš ï¸ 6/7 (Dead Code) | âœ… **100%** (import+í˜¸ì¶œ ì¶”ê°€ í›„ ì¬ë°°í¬) |

---

## 8. êµí›ˆ ë° ì¬ë°œ ë°©ì§€

### ê·¼ë³¸ ì›ì¸
í”„ë¡œì íŠ¸ì— `edge-function/`(êµ¬ë²„ì „ ì‚¬ë³¸)ê³¼ `supabase/functions/rag-chat/`(ë°°í¬ ì½”ë“œ) ë‘ ë””ë ‰í† ë¦¬ê°€ ê³µì¡´í•˜ì—¬, ì½”ë“œ ë¦¬ë·° ë„êµ¬ê°€ ì˜ëª»ëœ ë””ë ‰í† ë¦¬ë¥¼ ê²€í† .

### ì¬ë°œ ë°©ì§€ ì¡°ì¹˜
| ì¡°ì¹˜ | ìƒíƒœ |
|---|---|
| `edge-function/` ë””ë ‰í† ë¦¬ ì™„ì „ ì‚­ì œ | âœ… ì™„ë£Œ (`38fb40f`) |
| ë°°í¬ ë””ë ‰í† ë¦¬ ëª…ì‹œ ê¸°ë¡ (ë³¸ ë³´ê³ ì„œ) | âœ… ì™„ë£Œ |
| AI ì½”ë“œ ë¦¬ë·° ë„êµ¬ ê²°ê³¼ëŠ” ë°˜ë“œì‹œ êµì°¨ ê²€ì¦ | âš ï¸ í”„ë¡œì„¸ìŠ¤ ê¶Œê³  |
| ìë™í™” ë¦¬ë·° ì‹œ ê²€í†  ëŒ€ìƒ ê²½ë¡œë¥¼ `.reviewrc`ë¡œ ëª…ì‹œ | ğŸ“‹ í–¥í›„ ë„ì… ê²€í†  |

# Track B-1: ë„ë©”ì¸ ë™ì˜ì–´ ê²€ìƒ‰ í™•ì¥ â€” ê¸°ìˆ ì„œ

> **ì‘ì„±ì¼:** 2026-02-19  
> **ìƒíƒœ:** âœ… ì™„ë£Œ (v105 ë°°í¬)  
> **ëŒ€ìƒ ì‹œìŠ¤í…œ:** Supabase Edge Function `rag-chat`  
> **í•µì‹¬ ì„±ê³¼:** "peê´€" ê²€ìƒ‰ ê²°ê³¼ **2ê°œ ë¶„ì•¼ â†’ 8ê°œ ë¶„ì•¼**

---

## 1. ë¬¸ì œ ì •ì˜

### 1.1 ì¦ìƒ
ì‚¬ìš©ìê°€ `"peê´€"`ì„ ê²€ìƒ‰í•˜ë©´ **2ê°œ ë¶„ì•¼**ë§Œ ë°˜í™˜ë¨:

| # | ì˜µì…˜ | ì„¹ì…˜ ID |
|---|------|---------|
| 1 | ê°€êµí™” í´ë¦¬ì—í‹¸ë Œê´€ ì ‘í•© ë° ë°°ê´€ | 1-6-3#2 |
| 2 | PEë“œëŸ¼ ì„¤ì¹˜ ë° í•´ì²´ | 2-9-4 |

### 1.2 ê¸°ëŒ€ ê²°ê³¼
PEê´€ê³¼ **ë„ë©”ì¸ì ìœ¼ë¡œ ì—°ê´€ëœ** ì‘ì—…(ë°”íŠ¸ìœµì°©, ì†Œì¼“ìœµì°©, ìƒˆë“¤ìœµì°© ë“±)ì„ í¬í•¨í•œ **5ê°œ ì´ìƒì˜ ë¶„ì•¼**ê°€ ë°˜í™˜ë˜ì–´ì•¼ í•¨.

### 1.3 ì˜í–¥ ë²”ìœ„
- ë™ì¼ ë¬¸ì œê°€ "ìš©ì ‘", "ë°°ê´€", "ë°©ìˆ˜" ë“± ëª¨ë“  ë„ë©”ì¸ ë™ì˜ì–´ í•„ìš” ê²€ìƒ‰ì–´ì— ì ìš©
- ì‚¬ìš©ìê°€ ì¼ë°˜ì  ìš©ì–´ë¡œ ê²€ìƒ‰ ì‹œ ê´€ë ¨ ì‘ì—…ì„ ë†“ì¹˜ëŠ” í•µì‹¬ UX ê²°í•¨

---

## 2. ê·¼ë³¸ ì›ì¸ ë¶„ì„ (Root Cause Analysis)

### 2.1 ê·¼ë³¸ ì›ì¸ #1: ë°°í¬ ê²½ë¡œ ë¶ˆì¼ì¹˜ (Critical)

```
ìˆ˜ì •í•œ íŒŒì¼ ê²½ë¡œ:    edge-function/*.ts
ì‹¤ì œ ë°°í¬ ê²½ë¡œ:      supabase/functions/rag-chat/*.ts
```

Supabase CLI `npx supabase functions deploy rag-chat`ì€ `supabase/functions/rag-chat/` ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ì„ ë°°í¬í•œë‹¤. ê·¸ëŸ¬ë‚˜ ê°œë°œ ì¤‘ `edge-function/` ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ë§Œ ìˆ˜ì •í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì—, **ì•„ë¬´ë¦¬ ì½”ë“œë¥¼ ìˆ˜ì •í•´ë„ ë°°í¬ì— ë°˜ì˜ë˜ì§€ ì•Šì•˜ë‹¤.**

> [!CAUTION]
> ì´ ë¶ˆì¼ì¹˜ë¡œ ì¸í•´ v100~v103ê¹Œì§€ **4ë²ˆì˜ ë°°í¬ê°€ ëª¨ë‘ ë¬´íš¨**ì˜€ìœ¼ë©°, ì•½ 3ì‹œê°„ì˜ ë””ë²„ê¹… ì‹œê°„ì´ ì†Œìš”ë¨.

```mermaid
graph LR
    A["ì½”ë“œ ìˆ˜ì •<br/>edge-function/*.ts"] --> B["ë°°í¬ ëª…ë ¹<br/>npx supabase functions deploy"]
    B --> C["ì—…ë¡œë“œ<br/>supabase/functions/rag-chat/*.ts"]
    A -.->|"âŒ ê²½ë¡œ ë¶ˆì¼ì¹˜"| C
    style A fill:#ff6b6b,color:#fff
    style C fill:#ff6b6b,color:#fff
```

**í•´ê²°:** `edge-function/` â†’ `supabase/functions/rag-chat/`ë¡œ ìˆ˜ì •ëœ 3ê°œ íŒŒì¼(search.ts, resolve.ts, index.ts) ë³µì‚¬ í›„ ì¬ë°°í¬.

---

### 2.2 ê·¼ë³¸ ì›ì¸ #2: ì‹¤í–‰ ê²½ë¡œ ì˜¤íŒ (Critical)

"peê´€" ì¿¼ë¦¬ì˜ **ì‹¤ì œ ì‹¤í–‰ ê²½ë¡œ**ë¥¼ ì˜ëª» íŒŒì•…í•˜ì—¬, ë¬´ê´€í•œ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê³  ìˆì—ˆë‹¤.

#### ê°€ì •í•œ ì‹¤í–‰ ê²½ë¡œ (ì˜¤ë‹µ)
```
handleChat â†’ analyzeIntent(intent: "clarify_needed")
  â†’ graphClarify()
    â†’ resolveSection() â†’ resolveBySearch()
      â†’ presentClarify() [multi_section í•¸ë“¤ëŸ¬]
```

#### ì‹¤ì œ ì‹¤í–‰ ê²½ë¡œ (ì •ë‹µ)
```
handleChat â†’ analyzeIntent(intent: "search"/"answer")
  â†’ searchPipeline()
    â†’ targetSearch() â†’ entities (Section only)
      â†’ sectionOnly = true
        â†’ sectionSourceIds.length > 1
          â†’ ì§ì ‘ clarify ì‘ë‹µ ìƒì„± (index.ts L643-679)
```

**ì¦ê±°:** ì‘ë‹µ ë©”ì‹œì§€ í˜•ì‹ ë¹„êµ

| ì½”ë“œ ê²½ë¡œ | ë©”ì‹œì§€ í˜•ì‹ |
|-----------|------------|
| `presentClarify` (resolve.ts) | `"${searchTerms.join(" ")}"` â†’ `"PEê´€ PEê´€ HDPEê´€..."` |
| `searchPipeline` (index.ts) | `"${question}"` â†’ `"peê´€"` |

ì‹¤ì œ ì‘ë‹µ: `"PEê´€ PEê´€ HDPEê´€ PEë“œëŸ¼ í´ë¦¬ì—í‹¸ë Œ"` â†’ `presentClarify` ê²½ìœ  í™•ì¸.
**í•˜ì§€ë§Œ** ë””ë²„ê·¸ íƒœê·¸ `[debug]`ê°€ ë¯¸ì¶œë ¥ â†’ ì´ì „ ë°°í¬ì—ì„œëŠ” resolve.ts ìˆ˜ì •ì´ ë°˜ì˜ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ (ê·¼ë³¸ ì›ì¸ #1), `searchPipeline`ì˜ ì›ë³¸ ì½”ë“œê°€ ì‹¤í–‰.

> [!NOTE]
> LLMì˜ intent ë¶„ë¥˜ê°€ **ì‹¤í–‰ë§ˆë‹¤ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ**, `searchPipeline`ê³¼ `graphClarify` **ì–‘ìª½ ëª¨ë‘** ë™ì˜ì–´ í™•ì¥ì´ ì ìš©ë˜ì–´ì•¼ í•œë‹¤.

---

### 2.3 ê·¼ë³¸ ì›ì¸ #3: Case-Sensitive ë™ì˜ì–´ ë§¤ì¹­ (Medium)

`expandDomainSynonyms` í•¨ìˆ˜ì—ì„œ `term.includes(key)` ë¹„êµê°€ **ëŒ€ì†Œë¬¸ì êµ¬ë¶„**ì´ì—ˆë‹¤.

```typescript
// âŒ Before: case-sensitive
if (term.includes(key) || key.includes(term)) {
    expanded.push(...synonyms);
}
```

LLMì´ `work_name`ì„ `"PEê´€"` (ëŒ€ë¬¸ì)ë¡œ ë°˜í™˜í•  ìˆ˜ë„, `"peê´€"` (ì†Œë¬¸ì)ë¡œ ë°˜í™˜í•  ìˆ˜ë„ ìˆë‹¤. DOMAIN_SYNONYM_MAPì˜ í‚¤ëŠ” `"PEê´€"` (ëŒ€ë¬¸ì)ì´ë¯€ë¡œ, `"peê´€".includes("PEê´€")` â†’ `false`ê°€ ë˜ì–´ ë§¤ì¹­ ì‹¤íŒ¨.

```typescript
// âœ… After: case-insensitive
const termUpper = term.toUpperCase();
const keyUpper = key.toUpperCase();
if (termUpper.includes(keyUpper) || keyUpper.includes(termUpper)) {
    expanded.push(...synonyms);
}
```

---

## 3. êµ¬í˜„ ìƒì„¸

### 3.1 ìˆ˜ì • íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ë³€ê²½ ìœ í˜• | í•µì‹¬ ë³€ê²½ ë‚´ìš© |
|------|----------|---------------|
| `search.ts` | ì‹ ê·œ ê¸°ëŠ¥ ì¶”ê°€ | `DOMAIN_SYNONYM_MAP` ì‚¬ì „ + `expandDomainSynonyms()` í•¨ìˆ˜ |
| `index.ts` | ë¡œì§ í™•ì¥ | `searchPipeline` sectionOnly ë¶„ê¸°ì— ë™ì˜ì–´ WorkType í™•ì¥ |
| `resolve.ts` | ë¡œì§ í™•ì¥ | `resolveBySearch` + `presentClarify` multi_section í•¸ë“¤ëŸ¬ í™•ì¥ |

---

### 3.2 search.ts â€” ë„ë©”ì¸ ë™ì˜ì–´ ì‚¬ì „ ë° í™•ì¥ í•¨ìˆ˜

#### DOMAIN_SYNONYM_MAP

ê±´ì„¤ ë„ë©”ì¸ì—ì„œ **ì´ë¦„ì´ ë‹¤ë¥´ì§€ë§Œ ì˜ë¯¸ì ìœ¼ë¡œ ì—°ê´€ëœ ì‘ì—…**ì„ ì–‘ë°©í–¥ ë§¤í•‘:

```typescript
const DOMAIN_SYNONYM_MAP: Record<string, string[]> = {
    "PEê´€":       ["ë°”íŠ¸ìœµì°©", "ì†Œì¼“ìœµì°©", "ìƒˆë“¤ìœµì°©", "í´ë¦¬ì—í‹¸ë Œ", "HDPE", "ë²„íŠ¸ìœµì°©"],
    "í´ë¦¬ì—í‹¸ë Œê´€": ["ë°”íŠ¸ìœµì°©", "ì†Œì¼“ìœµì°©", "ìƒˆë“¤ìœµì°©", "PEê´€", "HDPE"],
    "ìœµì°©":       ["ë°”íŠ¸ìœµì°©", "ì†Œì¼“ìœµì°©", "ìƒˆë“¤ìœµì°©", "PEê´€", "í´ë¦¬ì—í‹¸ë Œ"],
    "ê°€ìŠ¤ê´€":     ["PEê´€", "í´ë¦¬ì—í‹¸ë Œ", "ë°”íŠ¸ìœµì°©", "ì†Œì¼“ìœµì°©"],
    "ìš©ì ‘":       ["TIG", "MIG", "MAG", "CO2", "ì•„í¬ìš©ì ‘", "ê°€ìŠ¤ìš©ì ‘", "í”¼ë³µì•„í¬"],
    "ë°°ê´€":       ["ê°•ê´€", "í´ë¦¬ì—í‹¸ë Œê´€", "PVCê´€", "PEê´€", "ë™ê´€", "ìŠ¤í…Œì¸ë¦¬ìŠ¤ê´€"],
    "ë„ì¥":       ["í˜ì¸íŠ¸", "ë„ë£Œ", "ë°©ì²­", "í•˜ë„", "ìƒë„", "ì¤‘ë„"],
    "ë°©ìˆ˜":       ["ì•„ìŠ¤íŒ”íŠ¸ë°©ìˆ˜", "ì‹œíŠ¸ë°©ìˆ˜", "ë„ë§‰ë°©ìˆ˜", "ì‹¤ë§"],
    "ì² ê·¼":       ["ë°°ê·¼", "ì´ìŒ", "ì •ì°©", "ê°€ê³µì¡°ë¦½"],
};
```

> [!IMPORTANT]
> **ì„¤ê³„ ì›ì¹™:** ì‚¬ì „ì˜ í‚¤ëŠ” **ì‚¬ìš©ìê°€ ê²€ìƒ‰í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ì¼ë°˜ ìš©ì–´**, ê°’ì€ **DB ì—”í‹°í‹° ì´ë¦„ì— ì‹¤ì œ ë“±ì¥í•˜ëŠ” êµ¬ì²´ì  ì‘ì—…ëª…**ìœ¼ë¡œ êµ¬ì„±.

#### expandDomainSynonyms()

```typescript
export function expandDomainSynonyms(terms: string[]): string[] {
    const expanded: string[] = [];
    for (const term of terms) {
        const termUpper = term.toUpperCase();
        for (const [key, synonyms] of Object.entries(DOMAIN_SYNONYM_MAP)) {
            const keyUpper = key.toUpperCase();
            // ì–‘ë°©í–¥ ë§¤ì¹­ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
            if (termUpper.includes(keyUpper) || keyUpper.includes(termUpper)) {
                expanded.push(...synonyms);
            }
        }
    }
    return [...new Set(expanded)]; // ì¤‘ë³µ ì œê±°
}
```

**ë§¤ì¹­ ì˜ˆì‹œ:**

| ì…ë ¥ term | MAP key | termUpper.includes(keyUpper) | keyUpper.includes(termUpper) | ê²°ê³¼ |
|-----------|---------|------------------------------|------------------------------|------|
| `"peê´€"` | `"PEê´€"` | `"PEê´€".includes("PEê´€")` â†’ âœ… | â€” | ë§¤ì¹­ |
| `"PEê´€"` | `"PEê´€"` | `"PEê´€".includes("PEê´€")` â†’ âœ… | â€” | ë§¤ì¹­ |
| `"HDPEê´€"` | `"PEê´€"` | `"HDPEê´€".includes("PEê´€")` â†’ âœ… | â€” | ë§¤ì¹­ |
| `"í´ë¦¬ì—í‹¸ë Œ"` | `"í´ë¦¬ì—í‹¸ë Œê´€"` | â€” | `"í´ë¦¬ì—í‹¸ë Œê´€".includes("í´ë¦¬ì—í‹¸ë Œ")` â†’ âœ… | ë§¤ì¹­ |

---

### 3.3 index.ts â€” searchPipeline ë™ì˜ì–´ í™•ì¥

#### ë³€ê²½ ì „ (L640-679)

```typescript
if (sectionOnly) {
    const sectionSourceIds = [...new Set(entities.map(e => e.source_section))];
    if (sectionSourceIds.length > 1) {
        // Section ì—”í‹°í‹°ë§Œìœ¼ë¡œ ì˜µì…˜ ìƒì„± â†’ 2ê°œë§Œ ë°˜í™˜
        const options = entities.map(s => ({ ... }));
        return makeClarifyResponse(`${sectionSourceIds.length}ê°œ ë¶„ì•¼`, ...);
    }
}
```

#### ë³€ê²½ í›„

```typescript
if (sectionOnly) {
    const sectionSourceIds = [...new Set(entities.map(e => e.source_section))];

    // ğŸ’¡ ë„ë©”ì¸ ë™ì˜ì–´ë¡œ WorkType source_section í™•ì¥
    const domainTerms = analysis.work_name
        ? [analysis.work_name, ...(analysis.keywords || [])]
        : analysis.keywords || [];
    const domainExp = expandDomainSynonyms(domainTerms);

    let synonymWorkTypes: any[] = [];
    if (domainExp.length > 0) {
        // ë™ì˜ì–´ í‚¤ì›Œë“œë¡œ WorkType ì—”í‹°í‹° ì¶”ê°€ ê²€ìƒ‰
        const synOrClauses = domainExp.map(s => `name.ilike.%${s}%`).join(",");
        const { data: synWTs } = await supabase
            .from("graph_entities")
            .select("id, name, type, source_section, properties")
            .eq("type", "WorkType")
            .or(synOrClauses)
            .limit(50);
        if (synWTs) synonymWorkTypes = synWTs;
    }

    // Section + ë™ì˜ì–´ WorkTypeì˜ source_section ë³‘í•©
    const synSectionIds = [...new Set(synonymWorkTypes.map(w => w.source_section))];
    const allSectionIds = [...new Set([...sectionSourceIds, ...synSectionIds])];

    if (allSectionIds.length > 1) {
        // Section ì—”í‹°í‹° ê¸°ë°˜ ì˜µì…˜ ìƒì„±
        const options = entities.map(s => ({ ... }));

        // ë™ì˜ì–´ WorkTypeì˜ source_section ì¤‘ Sectionì— ì—†ëŠ” ê²ƒ ì¶”ê°€
        for (const wt of synonymWorkTypes) {
            if (!existingSrcSet.has(wt.source_section)) {
                options.push({ ... });  // ìƒˆ ì˜µì…˜ ì¶”ê°€
            }
        }

        return makeClarifyResponse(`${allSectionIds.length}ê°œ ë¶„ì•¼`, ...);
    }
}
```

```mermaid
flowchart TD
    A["searchPipeline ì‹œì‘"] --> B["targetSearch â†’ entities"]
    B --> C{"sectionOnly?"}
    C -->|Yes| D["sectionSourceIds ì¶”ì¶œ"]
    D --> E["ğŸ†• expandDomainSynonyms ì‹¤í–‰"]
    E --> F["ğŸ†• ë™ì˜ì–´ WorkType ê²€ìƒ‰"]
    F --> G["allSectionIds = Section + ë™ì˜ì–´ ë³‘í•©"]
    G --> H{"allSectionIds > 1?"}
    H -->|Yes| I["Multi-section clarify ì‘ë‹µ<br/>Section + ë™ì˜ì–´ ì˜µì…˜ í¬í•¨"]
    H -->|No| J["ë‹¨ì¼ ì„¹ì…˜ â†’ í•˜ìœ„ WorkType í™•ì¸"]
    C -->|No| K["WorkType í¬í•¨ â†’ ê¸°ì¡´ ë¡œì§"]

    style E fill:#4ecdc4,color:#fff
    style F fill:#4ecdc4,color:#fff
    style G fill:#4ecdc4,color:#fff
```

---

### 3.4 resolve.ts â€” resolveBySearch + presentClarify í™•ì¥

#### ì „ëµ 1-A: Section ê²€ìƒ‰ í™•ì¥

```diff
 // ì „ëµ 1-A: Section ì´ë¦„ ILIKE (+ ë„ë©”ì¸ ë™ì˜ì–´)
 const sectionPattern = "%" + searchTerms[0] + "%";
+const synonymSrc1A = work_name ? [work_name, searchTerms[0]] : [searchTerms[0]];
+const sectionSynonyms = expandDomainSynonyms([...new Set(synonymSrc1A)]);
 const sectionOrClauses = [
     `name.ilike.${sectionPattern}`,
+    ...sectionSynonyms.map(s => `name.ilike.%${s}%`),
 ].join(",");
```

#### ì „ëµ 2: WorkType ê²€ìƒ‰ í™•ì¥

```diff
 // ì „ëµ 2: WorkType ì§ì ‘ íƒìƒ‰
+// Why: searchTerms[0]ì´ í•œê¸€ ì •ê·œí™”ë¡œ ì›ë³¸ì´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ
+//      raw work_nameë„ ë™ì˜ì–´ í™•ì¥ ì†ŒìŠ¤ì— í¬í•¨
+const synonymSource = work_name ? [...new Set([work_name, ...wTerms])] : wTerms;
+const domainExp = expandDomainSynonyms(synonymSource);
 const workOrClauses = [
     ...wTerms.map(t => `name.ilike.%${t}%`),
     ...mixedExp.map(p => `name.ilike.${p}`),
+    ...domainExp.map(s => `name.ilike.%${s}%`),
 ].join(",");
```

#### presentClarify multi_section í•¸ë“¤ëŸ¬ í™•ì¥

```diff
 // WorkTypeì˜ source_section ì¤‘ Sectionì— ì—†ëŠ” ê²ƒë„ optionìœ¼ë¡œ ì¶”ê°€
+const wtBySrc = new Map<string, any>();
+for (const wt of workTypes) {
+    if (wt.source_section && !sectionSrcSet.has(wt.source_section)
+        && !wtBySrc.has(wt.source_section)) {
+        wtBySrc.set(wt.source_section, wt);
+    }
+}
+for (const [srcSec, wt] of wtBySrc) {
+    options.push({ label, query, source_section: srcSec, ... });
+}
```

---

### 3.5 search.ts â€” targetSearch ë™ì˜ì–´ í™•ì¥

`targetSearch` í•¨ìˆ˜ì˜ 1ë‹¨ê³„(work_name í´ë°±)ì™€ 2ë‹¨ê³„(í‚¤ì›Œë“œ ILIKE)ì—ë„ ë™ì˜ì–´ í™•ì¥ ì ìš©:

```typescript
// 1ë‹¨ê³„ work_name í´ë°±
const stage1Synonyms = expandDomainSynonyms([analysis.work_name]);
const fallbackOrClauses = [
    `name.ilike.${fallbackPattern}`,
    ...mixedPatterns.map(p => `name.ilike.${p}`),
    ...stage1Synonyms.map(s => `name.ilike.%${s}%`),  // ğŸ†•
].join(",");

// 2ë‹¨ê³„ í‚¤ì›Œë“œ ILIKE
const domainExpansions = expandDomainSynonyms(ilikeTerms);
const orClauses = [
    ...ilikeTerms.map(t => `name.ilike.%${t}%`),
    ...mixedExpansions.map(p => `name.ilike.${p}`),
    ...domainExpansions.map(s => `name.ilike.%${s}%`),  // ğŸ†•
].join(",");
```

---

## 4. ê²€ì¦ ê²°ê³¼

### 4.1 "peê´€" ê²€ìƒ‰ ê²°ê³¼ ë¹„êµ

| | ìˆ˜ì • ì „ | ìˆ˜ì • í›„ |
|---|---------|---------|
| **ë¶„ì•¼ ìˆ˜** | 2ê°œ | **8ê°œ** |
| **ì‘ë‹µ í¬ê¸°** | 701 bytes | **3,268 bytes** |
| **ì‘ë‹µ ì‹œê°„** | ~5s | ~6.4s (+1.4s) |
| **ë°”íŠ¸ìœµì°©** | âŒ ë¯¸í¬í•¨ | âœ… í¬í•¨ (6-5-4) |
| **ì†Œì¼“ìœµì°©** | âŒ ë¯¸í¬í•¨ | âœ… í¬í•¨ (6-5-3) |
| **ê°€ìŠ¤ìš©PEê´€** | âŒ ë¯¸í¬í•¨ | âœ… í¬í•¨ (11-3#2) |

### 4.2 DB ì§ì ‘ ì¿¼ë¦¬ ê²€ì¦

```sql
-- ë™ì˜ì–´ "ë°”íŠ¸ìœµì°©", "ì†Œì¼“ìœµì°©"ì´ ì‹¤ì œ DBì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
SELECT DISTINCT source_section FROM graph_entities
WHERE type = 'WorkType'
AND (name ILIKE '%ë°”íŠ¸ìœµì°©%' OR name ILIKE '%ì†Œì¼“ìœµì°©%');
-- ê²°ê³¼: 6-5-3, 6-5-4 âœ…
```

### 4.3 ì „ì²´ ì˜µì…˜ ëª©ë¡ (8ê°œ)

| # | ë ˆì´ë¸” | ì„¹ì…˜ ID | ì¶œì²˜ |
|---|--------|---------|------|
| 1 | ê¸°ê³„ì„¤ë¹„ë¶€ë¬¸ > ë°°ê´€ê³µì‚¬ > ê°€êµí™” í´ë¦¬ì—í‹¸ë Œê´€ ì ‘í•© ë° ë°°ê´€ | 1-6-3#2 | Section ì§ì ‘ ë§¤ì¹­ |
| 2 | ê³µí†µë¶€ë¬¸ > ê°€ì„¤ê³µì‚¬ > PEë“œëŸ¼ ì„¤ì¹˜ ë° í•´ì²´ | 2-9-4 | Section ì§ì ‘ ë§¤ì¹­ |
| 3 | í† ëª©ë¶€ë¬¸ > ê´€ë¶€ì„¤ ë° ì ‘í•©ê³µì‚¬ > **ë°”íŠ¸ìœµì°© ì ‘í•© ë° ë¶€ì„¤** | **6-5-4** | ğŸ†• ë™ì˜ì–´ í™•ì¥ |
| 4 | í† ëª©ë¶€ë¬¸ > ê´€ë¶€ì„¤ ë° ì ‘í•©ê³µì‚¬ > **ì†Œì¼“ìœµì°© ì ‘í•© ë° ë¶€ì„¤** | **6-5-3** | ğŸ†• ë™ì˜ì–´ í™•ì¥ |
| 5 | ê¸°ê³„ì„¤ë¹„ë¶€ë¬¸ > ê°€ìŠ¤ì„¤ë¹„ê³µì‚¬ > ë¶€ì†ê¸°ê¸° | 11-3#2 | ğŸ†• ë™ì˜ì–´ í™•ì¥ |
| 6 | ìœ ì§€ê´€ë¦¬ë¶€ë¬¸ > ê¸°ê³„ì„¤ë¹„ > ë°°ê´€ë³´ì˜¨ í•´ì²´ | 4-1-4#3 | ğŸ†• ë™ì˜ì–´ í™•ì¥ |
| 7 | ê³µí†µë¶€ë¬¸ > ê¸°ì´ˆê³µì‚¬ > ì°¨ìˆ˜ì¬ê³µ | 5-4-1 | ğŸ†• ë™ì˜ì–´ í™•ì¥ |
| 8 | ê¸°ê³„ì„¤ë¹„ë¶€ë¬¸ > í”ŒëœíŠ¸ì„¤ë¹„ê³µì‚¬ > ê´€ë§Œê³¡(Pipe Bending) ì„¤ì¹˜ | 13-1-2 | ğŸ†• ë™ì˜ì–´ í™•ì¥ |

---

## 5. ë””ë²„ê¹… ì—¬ì • íƒ€ì„ë¼ì¸

| ì‹œê°„ | ì‘ì—… | ê²°ê³¼ |
|------|------|------|
| 11:00 | `search.ts` `expandDomainSynonyms` êµ¬í˜„ + case-sensitive | ë°°í¬ í›„ ë³€í™” ì—†ìŒ |
| 11:30 | case-insensitive `toUpperCase()` ìˆ˜ì • | ë³€í™” ì—†ìŒ |
| 12:00 | `resolve.ts` `resolveBySearch` ì „ëµ 1-A, 2ì— ë™ì˜ì–´ í™•ì¥ | ë³€í™” ì—†ìŒ |
| 12:30 | `resolve.ts` `presentClarify` multi_section WorkType í™•ì¥ | ë³€í™” ì—†ìŒ |
| 13:00 | ë””ë²„ê·¸ íƒœê·¸ `[debug]` ì‚½ì… â†’ ë¯¸ì¶œë ¥ í™•ì¸ | **ì‹¤í–‰ ê²½ë¡œ ì˜¤íŒ ë°œê²¬** |
| 13:15 | `grep "ê°œ ë¶„ì•¼"` â†’ `index.ts L671` ë°œê²¬ | **searchPipelineì´ ì‹¤ì œ ê²½ë¡œ** |
| 13:30 | `index.ts` searchPipelineì— ë™ì˜ì–´ í™•ì¥ íŒ¨ì¹˜ | ë°°í¬ í›„ ë³€í™” ì—†ìŒ |
| 13:45 | `grep "DOMAIN_SYNONYM"` â†’ `supabase/` ê²½ë¡œ 0ê±´ | **ë°°í¬ ê²½ë¡œ ë¶ˆì¼ì¹˜ ë°œê²¬** |
| 14:00 | íŒŒì¼ ë³µì‚¬ + Supabase ì¬ë¡œê·¸ì¸ + ë°°í¬ | **ğŸ‰ 8ê°œ ë¶„ì•¼ ì„±ê³µ!** |

> [!WARNING]
> **êµí›ˆ:** `edge-function/`ê³¼ `supabase/functions/rag-chat/` ë‘ ê²½ë¡œì˜ íŒŒì¼ ë™ê¸°í™”ê°€ í•„ìˆ˜. í–¥í›„ ìˆ˜ì • ì‹œ ë°˜ë“œì‹œ `supabase/functions/rag-chat/` ê²½ë¡œì—ì„œ ì§ì ‘ ìˆ˜ì •í•˜ê±°ë‚˜, ë°°í¬ ì „ ìë™ ë³µì‚¬ ìŠ¤í¬ë¦½íŠ¸ ë„ì… ê¶Œì¥.

---

## 6. í–¥í›„ ê³¼ì œ

### 6.1 DOMAIN_SYNONYM_MAP í™•ì¥
í˜„ì¬ 9ê°œ í‚¤ë§Œ ë“±ë¡. ì¶”ê°€ í•„ìš” í›„ë³´:
- `"ì½˜í¬ë¦¬íŠ¸"` â†’ `["íƒ€ì„¤", "ê±°í‘¸ì§‘", "ì–‘ìƒ", "ë ˆë¯¸ì½˜"]`
- `"í¬ì¥"` â†’ `["ì•„ìŠ¤íŒ”íŠ¸", "ì½˜í¬ë¦¬íŠ¸í¬ì¥", "ë‹¤ì§"]`
- `"êµ´ì°©"` â†’ `["í„°íŒŒê¸°", "ë˜ë©”ìš°ê¸°", "í† ê³µ"]`

### 6.2 íŒŒì¼ ë™ê¸°í™” ìë™í™”
`edge-function/` â†” `supabase/functions/rag-chat/` ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ì‹¬ë³¼ë¦­ ë§í¬ ì„¤ì •.

### 6.3 ì‘ë‹µ ì‹œê°„ ìµœì í™”
ë™ì˜ì–´ í™•ì¥ìœ¼ë¡œ +1.4s ì¦ê°€ (5.1s â†’ 6.4s). ë™ì˜ì–´ WorkType ì¿¼ë¦¬ë¥¼ Section ì¿¼ë¦¬ì™€ ë³‘ë ¬ ì‹¤í–‰í•˜ì—¬ latency ì ˆê° ê°€ëŠ¥.

---

## 7. ê´€ë ¨ íŒŒì¼

| íŒŒì¼ | ê²½ë¡œ |
|------|------|
| search.ts (ë°°í¬ìš©) | `supabase/functions/rag-chat/search.ts` |
| index.ts (ë°°í¬ìš©) | `supabase/functions/rag-chat/index.ts` |
| resolve.ts (ë°°í¬ìš©) | `supabase/functions/rag-chat/resolve.ts` |
| search.ts (ê°œë°œìš©) | `edge-function/search.ts` |
| index.ts (ê°œë°œìš©) | `edge-function/index.ts` |
| resolve.ts (ê°œë°œìš©) | `edge-function/resolve.ts` |
| í…ŒìŠ¤íŠ¸ ê²°ê³¼ (before) | `pipeline/phase2_output/logs/pe_trackb1_v6.json` |
| í…ŒìŠ¤íŠ¸ ê²°ê³¼ (after) | `pipeline/phase2_output/logs/pe_trackb1_REAL_v1.json` |

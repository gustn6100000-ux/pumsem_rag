# ê±´ì„¤í’ˆì…ˆ RAG ì‹œìŠ¤í…œ â€” ì”ì—¬ ì‘ì—… ìƒì„¸ êµ¬í˜„ ê³„íšì„œ

> **ì‘ì„±ì¼**: 2026-02-23  
> **ë²„ì „**: v2.0 (ì•„í‚¤í…íŠ¸ ë¦¬ë·° ë°˜ì˜ í™•ì •íŒ)  
> **ê¸°ë°˜**: ì›ì•ˆ + ê°œì„ íŒ ì•„í‚¤í…íŠ¸ ë¹„êµ ë¶„ì„ ê²°ê³¼ í†µí•©  
> **ëŒ€ìƒ**: Phase 4, Phase 1.5-C, Phase 2, Phase 3

---

## 0. ì•„í‚¤í…íŠ¸ ë¦¬ë·° ë°˜ì˜ ì¶”ì í‘œ

| # | ë°˜ì˜ í•­ëª© | ì¶œì²˜ | ë°˜ì˜ ìœ„ì¹˜ |
|---|---|---|---|
| 1 | `get_related_resources_v2()` ë¬´ì¤‘ë‹¨ ë°°í¬ | ê°œì„ íŒ | Phase 4 Â§4-1 |
| 2 | ì„œí‚· ë¸Œë ˆì´ì»¤ + íƒ€ì„ì•„ì›ƒ 15ì´ˆ | ê°œì„ íŒ + ì•„í‚¤í…íŠ¸ ë³´ì™„ | Phase 2 Â§2-3 |
| 3 | í”„ë¡ íŠ¸ì—”ë“œ Thinking UI | ê°œì„ íŒ | Phase 2 Â§2-4 [NEW] |
| 4 | ìˆ˜í•™ ê³µì‹ ì¡°ê±´ë¶€ ì£¼ì… (í† í° ì ˆê°) | ê°œì„ íŒ | Phase 3 Â§3-1 |
| 5 | ~~`context.ts` ì •ë¦¬~~ | âŒ ì‚­ì œ | ì½”ë“œ ê²€ì¦: ì£½ì€ ì½”ë“œ ì—†ìŒ (3í•¨ìˆ˜ ëª¨ë‘ ì‚¬ìš© ì¤‘) |
| 6 | ~~`deduplicateResults`/`deduplicateWorkTypes` ì‚­ì œ~~ | âŒ ì‚­ì œ | ì½”ë“œ ê²€ì¦: ì´ë¯¸ ì œê±° ì™„ë£Œ |
| 7 | ~~`BaseEstimatorParser` ì¶”ìƒí™”~~ | âš ï¸ ë³´ë¥˜ | ì‚¬í›„ ë¦¬íŒ©í† ë§ìœ¼ë¡œ ì „í™˜ |

---

## Phase 4: RAG ê²€ìƒ‰ ë ˆì´ì–´ ê²½ëŸ‰í™” ë° ë¦¬íŒ©í† ë§

### Â§4-1. SQL RPC íŒ¨ì¹˜ (ë¬´ì¤‘ë‹¨ ë°°í¬)

#### [MODIFY] pipeline/sql/step2.7_create_search_functions.sql

**Track 1-A: `get_related_resources_v2()` ì‹ ê·œ ìƒì„±**

```sql
-- Why: ê¸°ì¡´ í•¨ìˆ˜ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ë©´ Edge Function ë°°í¬ ì „ê¹Œì§€ API ì¥ì•  ë°œìƒ
--      v2ë¥¼ ì‹ ê·œ ìƒì„± â†’ Edge Function ë°°í¬ â†’ êµ¬ë²„ì „ DROP ìˆœì„œë¡œ ë¬´ì¤‘ë‹¨ ë‹¬ì„±
CREATE OR REPLACE FUNCTION get_related_resources_v2(entity_id text)
RETURNS TABLE (
    direction text, relation text,
    related_id text, related_name text,
    related_type text, properties jsonb
) AS $$
BEGIN
    -- â­ outbound(ì •ë°©í–¥)ë§Œ ì¡°íšŒ â€” inbound ì „ë©´ ì‚­ì œ
    -- (Architect Warning A: ì—­íƒìƒ‰ì€ get_tasks_by_resource RPCë¥¼ ë°±ë¡œê·¸ì— ë³„ë„ ë¶„ë¦¬)
    RETURN QUERY
    SELECT 'outbound'::text, r.relation, r.target_id, e.name, e.type, r.properties
    FROM graph_relationships r JOIN graph_entities e ON e.id = r.target_id
    WHERE r.source_id = entity_id
    UNION ALL
    SELECT 'outbound'::text, r.relation, r.target_id, e.name, e.type, r.properties
    FROM graph_global_relationships r JOIN graph_entities e ON e.id = r.target_id
    WHERE r.source_id = entity_id;
END;
$$ LANGUAGE plpgsql;
```

**Track 1-B: `search_entities_by_embedding()` ë°˜í™˜ê°’ í™•ì¥**

```sql
-- source_section ì»¬ëŸ¼ ì¶”ê°€ â€” í›„ì† ì¿¼ë¦¬ ì œê±°ë¥¼ ìœ„í•œ ì„ ì œ ë°˜í™˜
ALTER FUNCTION search_entities_by_embedding -- ë°˜í™˜ í…Œì´ë¸”ì— source_section ì¶”ê°€
```

**ë¡¤ë°± ì „ëµ**: Edge Functionì´ ì•„ì§ v2ë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” í•œ, êµ¬ë²„ì „ì´ ì •ìƒ ë™ì‘. ë¬¸ì œ ë°œìƒ ì‹œ Edge Functionë§Œ ì´ì „ ë²„ì „ìœ¼ë¡œ ë˜ëŒë¦¼.

---

### Â§4-2. Edge Function ê²½ëŸ‰í™”

#### [MODIFY] edge-function/search.ts

- `targetSearch()`: SQL ë°˜í™˜ê°’ì˜ `source_section`ì„ ì§ì ‘ ì°¸ì¡°í•˜ë„ë¡ ìˆ˜ì •
- ê¸°ì¡´ `source_section` í›„ì† ì¡°íšŒ ë¸”ë¡ ì‚­ì œ (í˜„ì¬ëŠ” ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë‚˜ Phase 4ì—ì„œ ì‹ ê·œ ì¶”ê°€ í›„ ë°”ë¡œ ì‚¬ìš©)

#### [MODIFY] edge-function/resolve.ts

- (ë³„ë„ ì‚­ì œ ì‘ì—… ì—†ìŒ â€” `deduplicateWorkTypes()`ëŠ” ì´ë¯¸ ì œê±°ë¨)

#### [MODIFY] edge-function/index.ts â€” `buildContext()`

- ì—”í‹°í‹° ë Œë”ë§ ì‹œ **ë¬´ì¡°ê±´ ê³ ì • 4ì—´ ìŠ¤í‚¤ë§ˆ** (`|ì§ì¢…|ìˆ˜ëŸ‰|ë‹¨ìœ„|ê¸°ì¤€|`) ì ìš© (Architect Warning B)
- `per_unit` ê°’ì´ ë¹„ì–´ìˆì„ ê²½ìš° í•˜ì´í”ˆ(`-`)ìœ¼ë¡œ ì¹˜í™˜í•˜ì—¬ í…Œì´ë¸” ì •í•©ì„± ìœ ì§€
- ì •ê·œì‹ ë¬¸ìì—´ íŒŒì‹±(`match(/\([^)]+\)/)`) ì „ë©´ ì‚­ì œ â†’ `properties.spec` ë˜ëŠ” RPC ë°˜í™˜ê°’ì˜ `source_spec` ê°ì²´ë¥¼ ë§¤í•‘ 1ìˆœìœ„ë¡œ ì‚¬ìš© (Architect Warning C)

#### [MODIFY] edge-function/llm.ts â€” `SYSTEM_PROMPT`

- ê³ ì • 4ì—´ í…Œì´ë¸” ìƒì„± ê°•ì œ ì§€ì‹œë¬¸ ì¶”ê°€
- `per_unit` í‘œê¸° ê·œì¹™ ëª…ì‹œ (ê°’ ì—†ìœ¼ë©´ `-` ì¶œë ¥)

#### [MODIFY] edge-function/graph.ts â€” `expandGraph()`

- RPC í˜¸ì¶œì„ `get_related_resources` â†’ `get_related_resources_v2`ë¡œ êµì²´
- ë°°í¬ ì™„ë£Œ í›„ êµ¬ë²„ì „ RPC DROP ì‹¤í–‰

---

### Â§4-3. ë°°í¬ ìˆœì„œ (ë¬´ì¤‘ë‹¨)

```
Step 1: SQL íŒ¨ì¹˜ (v2 í•¨ìˆ˜ ìƒì„± + source_section ì¶”ê°€)
    â†’ êµ¬ë²„ì „ í•¨ìˆ˜ ìœ ì§€, ê¸°ì¡´ Edge Function ì •ìƒ ë™ì‘
        â†“
Step 2: Edge Function ë°°í¬ (graph.tsê°€ v2 ì°¸ì¡°)
    â†’ ì‹ /êµ¬ RPC ëª¨ë‘ ì¡´ì¬, ì¦‰ì‹œ ì „í™˜
        â†“
Step 3: êµ¬ë²„ì „ SQL DROP (get_related_resources ì‚­ì œ)
    â†’ í´ë¦° ìƒíƒœ
```

---

## Phase 1.5-C: Monster Table ì¬ì§ˆ ë° ì¶”ê°€ ê³µì¢… í™•ì¥

### Â§C-1. ê¸°ì¡´ íŒŒì„œ ì¬ì§ˆ í™•ì¥

#### [MODIFY] pipeline/scripts/parse_13_1_1.py

- ê¸°ì¡´ "ë°°ê´€ìš© íƒ„ì†Œê°•ê´€(KSD3507)" 1ì¢… ì™¸ **6ê°œ ì¬ì§ˆ** ì •ê·œì‹ ë§¤í•‘ í™•ì¥:

| # | ì¬ì§ˆ | í‘œì¤€ ì½”ë“œ | ì˜ˆìƒ ë ˆì½”ë“œ |
|---|---|---|---|
| 1 | ë°°ê´€ìš© íƒ„ì†Œê°•ê´€ | KSD3507 | âœ… 280ê±´ ì™„ë£Œ |
| 2 | ì••ë ¥ë°°ê´€ìš© íƒ„ì†Œê°•ê´€ | KSD3562 | ~280ê±´ |
| 3 | Crí•©ê¸ˆê°•ê´€ | A335 | ~200ê±´ |
| 4 | ìŠ¤í…ë ˆìŠ¤ê°•ê´€ | Type304 | ~280ê±´ |
| 5 | ì•Œë£¨ë¯¸ëŠ„ê´€ | â€” | ~150ê±´ |
| 6 | ë™ê´€ | â€” | ~150ê±´ |
| 7 | í™©ë™ê´€ | â€” | ~100ê±´ |

- ê° ì¬ì§ˆë³„ `normalize_material()` í•¨ìˆ˜ì˜ ì •ê·œì‹ íŒ¨í„´ ì¶”ê°€
- ê¸°ì¡´ í…Œì´ë¸” ì¸ë±ìŠ¤ í•˜ë“œì½”ë”©(`tables[0]`, `tables[1]`, `tables[2]`) â†’ **ì¬ì§ˆë³„ í…Œì´ë¸” ë²”ìœ„ ë™ì  íƒìƒ‰**ìœ¼ë¡œ ê°œì„ 

### Â§C-2. ë°¸ë¸Œë¥˜ íŒŒì„œ ì‹ ê·œ ì‘ì„±

#### [NEW] pipeline/scripts/parse_13_3_1.py

- ì œ13ì¥ 13-3-1 (í”Œëœì§€ ë° ë°¸ë¸Œë¥˜ ì„¤ì¹˜) ì „ìš© íŒŒì„œ
- êµ¬ê²½ë³„(15mm~1500mm) ì¸ë ¥ í’ˆì…ˆ ë§¤í•‘
- êµ¬ì¡°: `parse_13_1_1.py`ì„ ë…ë¦½ ë³µì œ í›„ í…Œì´ë¸” ë ˆì´ì•„ì›ƒì— ë§ê²Œ ìˆ˜ì •
- âš ï¸ `BaseEstimatorParser` ì¶”ìƒí™”ëŠ” **ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ** â€” ë°¸ë¸Œë¥˜ í…Œì´ë¸” í¬ë§·ì´ ë°°ê´€ê³¼ ìƒì´í•  ê²½ìš° ì¶”ìƒí™” ë¹„ìš©ì´ ì‹¤ìµ ì´ˆê³¼. ì¶”í›„ ê³µí†µ íŒ¨í„´ í™•ì¸ ì‹œ ì‚¬í›„ ë¦¬íŒ©í† ë§.

#### [NEW] pipeline/scripts/seed_13_3_1.ts

- íŒŒì‹±ëœ ë°¸ë¸Œ ì„¤ì¹˜ JSON â†’ Supabase `complex_table_specs` í…Œì´ë¸” ì ì¬
- Supabase JS SDKì˜ `.insert()` ë°°ì¹˜ ì²˜ë¦¬ (100ê±´ ë‹¨ìœ„)

---

## Phase 2: DeepSeek ë“€ì–¼ ëª¨ë¸ ë¼ìš°íŒ…

### Â§2-1. ë³µì¡ë„ íŒë³„ê¸°

#### [MODIFY] edge-function/clarify.ts

`classifyComplexity(question, analysis)` í•¨ìˆ˜ ì¶”ê°€:

```typescript
export function classifyComplexity(question: string, analysis: IntentAnalysis): "simple" | "complex" {
    let score = 0;

    // [ê¸°ì¤€ 1] ì§ˆë¬¸ ê¸¸ì´
    if (question.length > 80) score += 1;
    if (question.length > 150) score += 1;

    // [ê¸°ì¤€ 2] ë³µìˆ˜ ê³µì¢… í‚¤ì›Œë“œ (2ê°œ ì´ìƒ â†’ +2)
    const workPatterns = question.match(/[ê°€-í£]{2,}(í•´ì²´|ì² ê±°|ì„¤ì¹˜|ì‹œê³µ|íƒ€ì„¤|ìš©ì ‘|ë„ì¥|ë°©ìˆ˜|ë°°ê´€)/g) || [];
    if (workPatterns.length >= 2) score += 2;

    // [ê¸°ì¤€ 3] ì¡°ê±´/ìƒí™© í‚¤ì›Œë“œ ë¬¶ìŒ ì ìˆ˜ (Claude ë³´ì • #5)
    const conditionKeywords = ["ë†’ì´", "ê³ ì†Œ", "ì§€í•˜", "ìˆ˜ì¤‘", "ì•¼ê°„", "í˜‘ì†Œ", "ìœ„í—˜",
        "í• ì¦", "ë³´ì˜¨", "ë‹¨ì—´", "ë³´ì–‘", "ì–‘ì¤‘", "ì¸ì–‘", "í•´ì²´", "ì² ê±°"];
    const matched = conditionKeywords.filter(kw => question.includes(kw));
    if (matched.length >= 2) score += 2;
    else if (matched.length === 1) score += 1;

    // [ê¸°ì¤€ 4] ë¬¼ë¦¬ëŸ‰/ë‹¨ìœ„ í™˜ì‚° ì‹œê·¸ë„
    if (/\d+\s*(mm|t|T|í†¤|kg|mÂ²|ã¡|mÂ³|ã¥)/.test(question)) score += 1;
    if (/ë‘ê»˜|ì™¸ê²½|ë‚´ê²½|ì§ê²½|ì§€ë¦„|ë¬´ê²Œ|ì¤‘ëŸ‰/.test(question)) score += 1;

    // [ê¸°ì¤€ 5] ê°€ì´ë“œ ìš”ì²­
    if (/ì–´ë–»ê²Œ|ì ìš©|ë°©ë²•|ì‚°ì¶œ|ê²¬ì |ë‚´ì—­/.test(question)) score += 1;

    // â­ ì„ê³„ê°’ 4ì  (Claude ë³´ì • #5 â€” ë³´ìˆ˜ì  ì‹œì‘, ë¡œê·¸ ê´€ì°° í›„ ì¡°ì •)
    return score >= 4 ? "complex" : "simple";
}
```

---

### Â§2-2. Reasoner ë§ˆìŠ¤í„°í”Œëœ ìƒì„±ê¸°

#### [MODIFY] edge-function/llm.ts

`generateReasoningGuide(question, history)` í•¨ìˆ˜ ì¶”ê°€:

- ëª¨ë¸: `deepseek-reasoner` (ì‚¬ê³  ëª¨ë“œ)
- (Claude ë³´ì • #5): `system` Role â†’ `user` ë©”ì‹œì§€ ì•ë‹¨ ë³‘í•©, `temperature` ì†ì„± ì œê±°
- í”„ë¡¬í”„íŠ¸: JSON `{search_tasks, calculations, adjustments}` ë§ˆìŠ¤í„°í”Œëœ ë°˜í™˜
- (Claude ë³´ì • #4): ìš°íšŒ ì¶”ë¡  í—ˆìš© ê·œì¹™ì€ **Reasoner ì „ìš© í”„ë¡¬í”„íŠ¸ì—ë§Œ ê²©ë¦¬**, Chat SYSTEM_PROMPTì—ëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠìŒ

---

### Â§2-3. ë©”ì¸ íŒŒì´í”„ë¼ì¸ ë¶„ê¸° (ì„œí‚· ë¸Œë ˆì´ì»¤ í¬í•¨)

#### [MODIFY] edge-function/index.ts â€” `handleChat()`

Route 4 (`searchPipeline`) ì§ì „ì— **Route 3.5** ì‚½ì… (Claude ë³´ì • #2):

```typescript
// â”€â”€â”€ Route 3.5: ë³µí•© ì§ˆë¬¸ â†’ Reasoner ê²½ë¡œ â”€â”€â”€
const complexity = classifyComplexity(question, analysis);

if (complexity === "complex") {
    try {
        // â­ ì„œí‚· ë¸Œë ˆì´ì»¤: 15ì´ˆ íƒ€ì„ì•„ì›ƒ, ì¬ì‹œë„ 0íšŒ (ì¦‰ì‹œ í´ë°±)
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 15_000);

        const { guide } = await generateReasoningGuide(question, history, controller.signal);
        clearTimeout(timeout);

        let parsedGuide: any = {};
        try { parsedGuide = JSON.parse(guide); } catch {
            // JSON íŒŒì‹± ì‹¤íŒ¨ â†’ ê¸°ì¡´ search ê²½ë¡œë¡œ í´ë°±
        }

        const searchTasks = parsedGuide.search_tasks || [];
        if (searchTasks.length > 0) {
            // ... ë‹¤ì¤‘ DB ê²€ìƒ‰ â†’ combinedContext ì¡°í•© â†’ generateAnswer()
            // (êµ¬í˜„ ìƒì„¸: ìµœì¢…í†µí•©_êµ¬í˜„ê³„íšì„œ_v2.md Â§2-4 ì°¸ì¡°)
        }
    } catch (err) {
        // â­ Reasoner ì‹¤íŒ¨/íƒ€ì„ì•„ì›ƒ â†’ ì¦‰ì‹œ ê¸°ì¡´ ê²½ë¡œ í´ë°±
        console.error("[handleChat] Reasoner ì„œí‚· ë¸Œë ˆì´ì»¤ ì‘ë™:", err);
    }
}

// Route 4: searchPipeline (ê¸°ì¡´ ë‹¨ìˆœ ê²½ë¡œ, ë³€ê²½ ì—†ìŒ)
return searchPipeline(analysis, question, history, startTime, answerOptions);
```

---

### Â§2-4. í”„ë¡ íŠ¸ì—”ë“œ Thinking UI

#### [MODIFY] frontend/app.js

- ë³µí•© ì§ˆì˜ ê°ì§€ ì‹œ(ì‘ë‹µ ì§€ì—° 2ì´ˆ ì´ˆê³¼) **"ğŸ§  ë³µí•© ì§ˆì˜ ë¶„ì„ ì¤‘..."** ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
- êµ¬í˜„ ë°©ì‹: `fetch` í˜¸ì¶œ í›„ 2ì´ˆ ê²½ê³¼ ì‹œ ì±„íŒ… UIì— "Thinking" ë©”ì‹œì§€ bubble ì‚½ì…, ì‘ë‹µ ë„ì°© ì‹œ êµì²´

```javascript
// â”€â”€â”€ Thinking UI (ë³µí•©ì¶”ë¡  5~8ì´ˆ UX ë°©ì–´) â”€â”€â”€
let thinkingTimer = null;
function showThinkingIfSlow() {
    thinkingTimer = setTimeout(() => {
        appendMessage('assistant', 'ğŸ§  ë³µí•© ì§ˆì˜ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...', true /* isThinking */);
    }, 2000);
}
function clearThinking() {
    if (thinkingTimer) clearTimeout(thinkingTimer);
    removeThinkingMessage();
}
```

---

## Phase 3: ë³µí•© ì¶”ë¡  íŒŒì´í”„ë¼ì¸

### Â§3-1. ë„ë©”ì¸ ìˆ˜í•™ ê³µì‹ â€” ì¡°ê±´ë¶€ ì£¼ì… (í† í° ì ˆê°)

#### [MODIFY] edge-function/llm.ts â€” `generateAnswer()`

- **ê¸°ì¡´ ê³„íš(ì „ë©´ ì‚½ì…)**ê³¼ ë‹¬ë¦¬, `options.complexity === "complex"` ì¼ ë•Œë§Œ SYSTEM_PROMPT í•˜ë‹¨ì— ê³µì‹ ì£¼ì…:

```typescript
if (options?.complexity === "complex") {
    systemContent += `\n\n[ê±´ì„¤ ë„ë©”ì¸ ìˆ˜í•™ ê³µì‹ â€” ì°¸ê³ ìš©]
ì»¨í…ìŠ¤íŠ¸ì— ë‹¨ìœ„ í™˜ì‚°ì´ í•„ìš”í•œ ë°ì´í„°ê°€ ìˆì„ ë•Œ ì•„ë˜ ê³µì‹ì„ í™œìš©í•˜ì„¸ìš”.
- ì›í†µ í‘œë©´ì : Ï€ Ã— ì™¸ê²½(m) Ã— ê¸¸ì´(m) = ã¡
- ê°•íŒ ì¤‘ëŸ‰: Ï€ Ã— ì™¸ê²½(m) Ã— ë‘ê»˜(m) Ã— ë¹„ì¤‘(7.85) Ã— ê¸¸ì´(m) = kg/m
- 1í†¤ í™˜ì‚° ê¸¸ì´: 1000kg Ã· (ë‹¨ìœ„ì¤‘ëŸ‰ kg/m) = m
- ë©´ì  í™˜ì‚°: ì›í˜• ë‹¨ë©´ â†’ Ï€ Ã— (D/2)Â² = ã¡
â€» ì´ ê³µì‹ì€ ë¬¼ë¦¬ ìƒìˆ˜ì— ê¸°ë°˜í•œ ê³ ì •ê°’ì´ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.`;
}
```

**í† í° ì ˆê° íš¨ê³¼**: ë‹¨ìˆœ ì§ˆë¬¸(80%) ì‹œ ~150í† í° ì ˆì•½ Ã— ì¼ 80ê±´ = **ì›”ê°„ ~360,000í† í° ì ˆê°**

---

### Â§3-2. IntentAnalysis íƒ€ì… í™•ì¥

#### [MODIFY] edge-function/types.ts

```diff
 export interface IntentAnalysis {
     intent: "search" | "clarify_needed" | "followup" | "greeting"
-        | "quantity_input" | "cost_calculate" | "modify_request" | "report_request";
+        | "quantity_input" | "cost_calculate" | "modify_request" | "report_request"
+        | "complex_estimate";
+    complexity?: "simple" | "complex";
 }
```

---

### Â§3-3. ìš°íšŒ ì¶”ë¡  ê·œì¹™ â€” Chat SYSTEM_PROMPTì— ë„£ì§€ ì•ŠìŒ âŒ

> [!CAUTION]
> Claude ë³´ì • #4 ì—„ê²© ì¤€ìˆ˜: "ìš°íšŒ ì¶”ë¡  í—ˆìš©" ê·œì¹™ì€ Reasoner ì „ìš© í”„ë¡¬í”„íŠ¸ì—ë§Œ ê²©ë¦¬.
> Chat(ë¹„ì‚¬ê³  ëª¨ë“œ)ëŠ” "contextì— ìˆëŠ” ë°ì´í„°ë§Œ ì‚¬ìš©"í•˜ëŠ” ê¸°ì¡´ í™˜ê° ì–µì œ ê·œì¹™ì„ ê·¸ëŒ€ë¡œ ìœ ì§€.

---

## ìˆ˜ì • ëŒ€ìƒ íŒŒì¼ ìš”ì•½

| Phase | íŒŒì¼ | ë³€ê²½ ìœ í˜• | í•µì‹¬ ë³€ê²½ |
|---|---|---|---|
| 4 | `step2.7_create_search_functions.sql` | MODIFY | `_v2()` ì‹ ê·œ + source_section ì¶”ê°€ |
| 4 | `edge-function/search.ts` | MODIFY | source_section ì§ì ‘ ì°¸ì¡° |
| 4 | `edge-function/index.ts` | MODIFY | buildContext ê³ ì •4ì—´ + source_spec ë§¤í•‘ |
| 4 | `edge-function/graph.ts` | MODIFY | RPC v2 ì „í™˜ |
| 4 | `edge-function/llm.ts` | MODIFY | 4ì—´ í…Œì´ë¸” ì§€ì‹œë¬¸ |
| 1.5-C | `parse_13_1_1.py` | MODIFY | 6ê°œ ì¬ì§ˆ í™•ì¥ |
| 1.5-C | `parse_13_3_1.py` | **NEW** | ë°¸ë¸Œë¥˜ íŒŒì„œ |
| 1.5-C | `seed_13_3_1.ts` | **NEW** | ë°¸ë¸Œ ë°ì´í„° ì ì¬ |
| 2 | `edge-function/clarify.ts` | MODIFY | classifyComplexity() |
| 2 | `edge-function/llm.ts` | MODIFY | generateReasoningGuide() |
| 2 | `edge-function/index.ts` | MODIFY | Route 3.5 + ì„œí‚·ë¸Œë ˆì´ì»¤ |
| 2 | `frontend/app.js` | MODIFY | Thinking UI |
| 3 | `edge-function/types.ts` | MODIFY | IntentAnalysis íƒ€ì… í™•ì¥ |
| 3 | `edge-function/llm.ts` | MODIFY | ìˆ˜í•™ ê³µì‹ ì¡°ê±´ë¶€ ì£¼ì… |

> ë³€ê²½ ì—†ëŠ” íŒŒì¼: `config.ts`, `embedding.ts`, `context.ts`, `resolve.ts` (ê¸°ì¡´ ì½”ë“œ ì•ˆì „)

---

## Verification Plan

### Phase 4 ê²€ì¦
1. `get_related_resources_v2()` SQL ì ìš© â†’ ê¸°ì¡´ Edge Functionìœ¼ë¡œ ê¸°ì¡´ ì¿¼ë¦¬ ì •ìƒ ë™ì‘ í™•ì¸ (ë¬´ì¤‘ë‹¨ ê²€ì¦)
2. Edge Function ë°°í¬ í›„ `ê°•ê´€ìš©ì ‘ 200mm SCH 40 ë‹¨ê°€ ì•Œë ¤ì¤˜` â†’ **ê³ ì • 4ì—´ í‘œ** ëˆ„ë½ ì—†ì´ ë…¸ì¶œ
3. êµ¬ë²„ì „ `get_related_resources()` DROP í›„ ì „ì²´ íšŒê·€ í…ŒìŠ¤íŠ¸

### Phase 1.5-C ê²€ì¦
1. `parse_13_1_1.py` í™•ì¥ ì‹¤í–‰ â†’ 6ê°œ ì¬ì§ˆ ë ˆì½”ë“œ ì´ ~1,440ê±´ JSON ìƒì„± í™•ì¸
2. `parse_13_3_1.py` + `seed_13_3_1.ts` â†’ `complex_table_specs` í…Œì´ë¸” ì¹´ìš´íŠ¸ ê²€ì‚¬
3. ì±—ë´‡: `ìŠ¤í…ë ˆìŠ¤ê°•ê´€ 100mm í”ŒëœíŠ¸ ë°°ê´€ ì„¤ì¹˜ ë…¸ë¬´ë¹„` â†’ Route 0.5 ì •ìƒ ê°ì§€

### Phase 2 & 3 ê²€ì¦
1. ë‹¨ìˆœ ì¿¼ë¦¬ `ê°•ê´€ìš©ì ‘ í’ˆì…ˆ ì•Œë ¤ì¤˜` â†’ Complexity Score < 4, `deepseek-chat` í˜¸ì¶œ í™•ì¸
2. ë³µí•© ì¿¼ë¦¬ `ì›í˜• ë•íŠ¸ 4T 1300mm í•´ì²´ + ë³´ì˜¨ ì² ê±° + ê³ ì†Œì‘ì—… 15m` â†’ `deepseek-reasoner` í˜¸ì¶œ
3. ì‘ë‹µ ì‹œê°„: ë‹¨ìˆœ 2~3ì´ˆ, ë³µí•© 5~8ì´ˆ (15ì´ˆ íƒ€ì„ì•„ì›ƒ ë¯¸ë„ë‹¬)
4. í”„ë¡ íŠ¸ì—”ë“œ: 2ì´ˆ ê²½ê³¼ ì‹œ "ğŸ§  ë¶„ì„ ì¤‘..." Thinking UI í‘œì‹œ í™•ì¸
5. ë…¸ë¬´ë¹„ êµì°¨ ê²€ì¦: ë„ë©”ì¸ ê³µì‹ ìˆ˜ê³„ì‚° vs LLM ì¶œë ¥ ëŒ€ì¡°

---

## ê¶Œì¥ êµ¬í˜„ ìˆœì„œ

```
Phase 4 (ì¦‰ì‹œ â€” 2~3ì¼)
  â”œâ”€ Day 1: SQL v2 í•¨ìˆ˜ ìƒì„± + source_section ì¶”ê°€
  â”œâ”€ Day 2: Edge Function ìˆ˜ì • (graph.ts, search.ts, index.ts, llm.ts)
  â”œâ”€ Day 2: ë°°í¬ + ê²€ì¦
  â””â”€ Day 3: êµ¬ë²„ì „ SQL DROP + íšŒê·€ í…ŒìŠ¤íŠ¸
       â†“
Phase 1.5-C (2~3ì¼)
  â”œâ”€ Day 1: parse_13_1_1.py 6ê°œ ì¬ì§ˆ í™•ì¥ + ê²€ì¦
  â”œâ”€ Day 2: parse_13_3_1.py ì‹ ê·œ ì‘ì„± + seed_13_3_1.ts
  â””â”€ Day 3: DB ì ì¬ + ì±—ë´‡ í†µí•© í…ŒìŠ¤íŠ¸
       â†“
Phase 2 (2~3ì¼)
  â”œâ”€ Day 1: classifyComplexity() + generateReasoningGuide()
  â”œâ”€ Day 2: handleChat Route 3.5 + ì„œí‚· ë¸Œë ˆì´ì»¤
  â”œâ”€ Day 2: frontend Thinking UI
  â””â”€ Day 3: ë°°í¬ + Reasoner ë¡œê·¸ ê²€ì¦
       â†“
Phase 3 (1ì¼)
  â”œâ”€ types.ts íƒ€ì… í™•ì¥
  â”œâ”€ ìˆ˜í•™ ê³µì‹ ì¡°ê±´ë¶€ ì£¼ì…
  â””â”€ NotebookLM ë¹„êµ í…ŒìŠ¤íŠ¸
```

**ì˜ˆìƒ ì´ ì†Œìš”: 7~10ì¼**

# Phase 1-2: Case D 매트릭스 패턴 추출 — 검증 결과

**수정 파일**: `step1_table_extractor.py`
**실행일**: 2026-02-12
**대상 섹션**: 13-2-3 (강관용접)

---

## 구현 내용

### 추가된 함수

| 함수명 | 역할 |
| --- | --- |
| `is_matrix_table()` | D_기타 테이블의 매트릭스 패턴(D1/D2) 감지 |
| `extract_from_matrix_table()` | 패턴별 라우팅 |
| `_extract_d1_metarow()` | D1: 메타행 패턴 (헤더=숫자, row[0]=직종명 매핑) |
| `_extract_d2_compound()` | D2: 복합 헤더 패턴 (헤더=`SCH_직종명(단위)`) |

### 테이블 패턴 예시

#### D1 패턴 (T-13-2-3-02, T-13-2-3-03)
```
headers: ['SCH No.', '20', '30', '40', '60', '80', '100', '120', '140', '160']
row[0]:  {SCH No.: '직종 구경', 20: '용접공', 30: '용접공', 40: '플랜트 용접공', ...}
row[1]:  {SCH No.: 'φ 15', 40: 0.066, 80: 0.075, 160: 0.087}
row[n]:  {SCH No.: 'φ 200', 20: 0.287, 30: 0.287, 40: 0.287, 60: 0.325, ...}
```

#### D2 패턴 (T-13-2-3-06-x, T-13-2-3-07-x)
```
headers: ['SCH No._직종', '20_플랜트 용접공 (인)', '20_특별인부 (인)', '30_플랜트 용접공 (인)', ...]
row[0]:  {SCH No._직종: 200, 20_플랜트 용접공 (인): 0.244, 20_특별인부 (인): 0.143, ...}
```

---

## 추출 규모 비교

| 항목 | Before (LLM only) | After (규칙 추출) | 증감 |
| --- | ---: | ---: | ---: |
| entities | 169 | **922** | +445% |
| relationships | 214 | **793** | +271% |

---

## 정밀 검증: 기대값 대조

| # | 구경 | SCH | 직종 | 기대값 | 추출값 | 판정 |
| ---: | --- | --- | --- | ---: | ---: | :---: |
| 1 | φ200 | 20 | 용접공 | 0.287 | 0.287 | ✅ MATCH |
| 2 | φ200 | 40 | 플랜트 용접공 | 0.294 | 0.294 | ✅ MATCH |
| 3 | φ200 | 60 | 플랜트 용접공 | 0.352 | 0.352 | ✅ MATCH |
| 4 | φ200 | 80 | 플랜트 용접공 | 0.416 | 0.416 | ✅ MATCH |
| 5 | φ15 | 40 | 플랜트 용접공 | 0.066 | 0.066 | ✅ MATCH |
| 6 | φ15 | 80 | 플랜트 용접공 | 0.075 | 0.075 | ✅ MATCH |
| 7 | φ200 | 20 | 플랜트용접공 | 0.244 | 0.244 | ✅ MATCH |
| 8 | φ200 | 20 | 특별인부 | 0.143 | 0.143 | ✅ MATCH |
| 9 | φ200 | 40 | 특별인부 | 0.172 | 0.172 | ✅ MATCH |
| 10 | φ350 | 20 | 플랜트용접공 | 0.438 | 0.438 | ✅ MATCH |

**결과: 10/10 전수 일치 (100%)**

---

## chunk별 추출 상세

| chunk_id | table_id | 패턴 | entities | rels | 비고 |
| --- | --- | :---: | ---: | ---: | --- |
| C-0955-A | T-02 범위값 | - | 8 | 7 | 기존 step1 추출 (A_품셈) |
| C-0955-B | T-02 | D1 | 145 | 144 | 노무 (용접공/플랜트 용접공) |
| C-0955-C | T-03 | D1 | 145 | 144 | 노무 36 + 자재 36 (용접봉) |
| C-0955-D | T-04 | D1 | 145 | 144 | 자재 72 (용접봉 kg) |
| C-0955-E | T-06-1 | D2 | 53 | 39 | 복합헤더 (플랜트용접공+특별인부) |
| C-0955-F | T-06-2 | D2 | 73 | 54 | |
| C-0955-G | T-06-3 | D2 | 121 | 90 | φ200~φ400 |
| C-0955-H | T-06-4 | D2 | 41 | 30 | φ500~φ600 |
| C-0955-I | T-07-1 | D2 | 37 | 27 | SCH 100~160 구간 |
| C-0955-J | T-07-2 | D2 | 105 | 78 | |
| C-0955-K | T-07-3 | D2 | 49 | 36 | |
| **합계** | | | **922** | **793** | |

---

## 생성되는 엔티티/관계 명명 규칙

- **WorkType**: `{섹션제목} ({구경}, SCH {번호})`
  - 예: `강관용접 (φ 200, SCH 40)` (D1) / `강관용접 (φ200, SCH 40)` (D2)
- **Labor**: 메타행 또는 복합헤더에서 추출한 직종명
  - 예: `용접공`, `플랜트 용접공`, `특별인부`
- **Material**: 자재 키워드 포함 시 Material로 분류
  - 예: `용접봉 (kg)`
- **Relationship**: `WorkType → Labor/Material`, qty = 셀 값 그대로

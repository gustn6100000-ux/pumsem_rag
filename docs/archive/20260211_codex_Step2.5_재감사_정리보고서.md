# 20260211 codex Step2.5 재감사 정리보고서

- 작성일: 2026-02-11
- 대상: Step 2.4/2.5 검증 흐름 및 Step2.5 최종보고서 정합성
- 작성자: codex

## 1. 수행 목적

Step2.5 최종보고서(`20260211_Step2.5_품질검증_최종보고서.md`)가 실제 산출물과 일치하는지 재감사하고,
불일치 원인을 수정한 뒤 검증 결과와 문서를 최신 상태로 동기화.

## 2. 주요 이슈(재감사 전)

1. E1 커버리지 절대건수 과대 집계
- 보고서 값: 2,019/2,105
- 실제 유효 chunk 기준: 2,018/2,105
- 원인: 빈 문자열 chunk_id(`""`)가 커버리지 set에 포함

2. source_chunk_ids 품질 이슈
- auto_hierarchy로 생성된 Section 일부에 `source_chunk_ids=['']` 저장
- 추적/커버리지 지표 왜곡 가능

3. 기준 문구-구현 불일치
- `step5_extraction_validator.py` 상단 설명은 E6 ≤5%였으나
- 실제 로직/리포트 기준은 E6 ≤40%

## 3. 코드 수정 내역

### 3.1 Step 2.4 수정
파일: `python_code/phase2_extraction/step4_normalizer.py`

- auto_hierarchy Section 생성 시:
  - 기존: `source_chunk_ids: [rel.get('source_chunk_id', '')]`
  - 변경: source_chunk_id가 있을 때만 배열에 포함, 없으면 빈 배열
- 출력 전 정리 로직 추가:
  - 모든 엔티티의 `source_chunk_ids`에서 빈 문자열 제거

### 3.2 Step 2.5 수정
파일: `python_code/phase2_extraction/step5_extraction_validator.py`

- E1 계산 로직 보정:
  - 빈값/무효 chunk_id를 커버리지 계산에서 제외
- 상단 기준 설명 보정:
  - E6 기준 문구를 실제 로직과 동일한 `≤40%`로 정정

## 4. 재실행 내역

1. `py -3 python_code\phase2_extraction\step4_normalizer.py`
2. `py -3 python_code\phase2_extraction\step5_extraction_validator.py`
- 인코딩 이슈(CP949) 대응: `PYTHONIOENCODING=utf-8`로 실행

## 5. 최신 검증 결과 (재실행 후)

출처:
- `python_code/phase2_output/quality_report_step25.txt`
- `python_code/phase2_output/extraction_report.json`

종합 판정: `CONDITIONAL_PASS`

| 항목 | 결과 | 기준 | 판정 |
| --- | --- | --- | --- |
| E1 | 2,018/2,105 = 95.9% | ≥90% | PASS |
| E2 | 24,649/24,649 = 100% | 100% | PASS |
| E3 | 10,585/10,688 = 99.0% | ≥95% | PASS |
| E4 | 3,979/16,364 = 24.3% | ≤30% | PASS |
| E5 | 0.427 | ≥0.85 | FAIL |
| E6 | 75/200 = 37.5% | ≤40% | PASS |

결론: 자동 구조 검증(E1~E4, E6)은 모두 통과, E5(LLM 샘플 감사)만 미달로 `CONDITIONAL_PASS` 유지.

## 6. 문서 동기화

파일: `python_code/docs/20260211_Step2.5_품질검증_최종보고서.md`

반영 완료:
- 검증 일시: `2026-02-11T17:01:42`
- E1: `2,018 / 2,105 = 95.9%`
- E5: `0.427`
- E5 세부 평균: `0.51 / 0.48 / 0.35 / 0.34`

## 7. 최종 상태

- Step2.5 보고서 수치와 실제 산출물 정합성 확보 완료
- 커버리지 왜곡 원인(빈 chunk_id) 코드 레벨 보정 완료
- 검증 기준 문구-구현 불일치(E6) 정정 완료
- 현재 운영 가능한 판정: `CONDITIONAL_PASS`

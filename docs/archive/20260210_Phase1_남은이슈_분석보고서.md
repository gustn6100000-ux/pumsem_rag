# Phase 1 전처리 파이프라인 — 남은 이슈 분석 보고서 (최종)

**작성일**: 2026-02-10
**최종 갱신**: 2026-02-10 21:28
**파이프라인 버전**: 최종 (43개 MD 파일, 9-17-5 누락 해소)

---

## 최종 결과 요약

| 항목              | 초기   | 1차 수정 | 2차 수정    | 최종 (현재)         |
| ----------------- | ------ | -------- | ----------- | ------------------- |
| **섹션 커버리지** | 58.26% | 98.75%   | 99.84%      | **99.92%**          |
| 누락 섹션         | 536개  | 16개     | 2개         | **1개**             |
| 총 청크 수        | 1,768  | 1,906    | 1,922→2,041 | **2,042**           |
| 총 테이블         | -      | -        | 3,006→3,178 | **3,179**           |
| 평균 토큰         | 841    | 777      | 776→774     | **773.9**           |
| 2,000토큰 초과    | 48개   | 7개      | 7→8개       | **8개 (유지 결정)** |
| 최대 토큰         | 4,641  | 3,536    | 3,536       | **3,536**           |

---

## 이슈 1: 미매핑 1개 섹션 (최종)

### 원인: CONTEXT 마커 미처리 (`13-3-1`)

MD 파일(`20260208_747-878 OKOK.md`)에 `<!-- CONTEXT: 13-3-1 | pipe보온 -->` 마커로 표시되어 있으나, step1은 `<!-- SECTION: -->` 마커만 처리하고 CONTEXT 마커는 제거만 한다.

**해결 방안**: CONTEXT 마커도 SECTION 마커처럼 섹션으로 처리하는 로직 추가
**영향**: 1,284개 중 1개 (0.08%) — 실질 영향 미미
**결정**: Phase 2 진입 전 해결 권장 (난이도 낮음)

### ✅ 해소된 이슈들

| 이슈                        | 해소 방법                        | 해소일                      |
| --------------------------- | -------------------------------- | --------------------------- |
| 14개 미매핑 (파일명 `*OK*`) | 파일명 변경 또는 글로브 확장     | 미시행 (파이프라인 외 작업) |
| `9-17-5` 미매핑 (PDF 누락)  | `20260210_542 OKOK.md` 수동 생성 | 2026-02-10                  |

> ⚠️ **14개 미매핑 (`943-948 OK.md`)은 파일명 패턴 불일치로 아직 미해소**. 파일명을 `943-948 OKOK.md`로 변경하면 즉시 해소 가능.

---

## 이슈 2: 8개 청크 2,000토큰 초과 — 유지 결정

### 사용자 결정: 그대로 유지

### 초과 청크 상세

| Chunk ID   | 토큰    | 섹션 ID | 제목                 | 초과 유형                 |
| ---------- | ------- | ------- | -------------------- | ------------------------- |
| C-0509-B   | ~3,204  | 9-1-2   | 1급 기준점 측량      | 넓은 테이블 (8열, 행 1개) |
| C-0512-C   | ~3,331  | 9-1-5   | 4급 기준점 측량      | 넓은 테이블 (7열, 행 1개) |
| C-0523-A-a | ~2,256  | 9-3-4   | 구획정리 확정측량    | 주석 11개 몰림            |
| C-0528-A-a | ~2,822  | 9-4-3   | 디지털 도로대장 작성 | 주석 17개 몰림            |
| C-0530-A-a | ~3,536  | 9-5-1   | 항공사진촬영         | 주석 30개+ 몰림           |
| C-0533-A-a | ~3,186  | 9-5-4   | 수치지도 작성        | 주석 30개+ 몰림           |
| C-0584-F   | ~2,000+ | 신규    | 신규 추가 파일 영역  | 테이블+텍스트             |
| C-0959-W   | ~2,036  | 13-2-7  | 아세틸렌량의 환산    | 넓은 테이블 (13열)        |

### 유지 시 잠재적 영향

| 영향 범위         | 설명                                                                                       | 심각도 |
| ----------------- | ------------------------------------------------------------------------------------------ | ------ |
| **임베딩 정밀도** | 2,000토큰 초과 시 text-embedding-3-small의 의미 압축이 발생하여 검색 정확도 소폭 하락 가능 | 🟡 중간 |
| **LLM 컨텍스트**  | 단일 청크가 3,500토큰이면 RAG 컨텍스트 윈도우에서 비중이 과다 (다른 관련 청크 배제 가능)   | 🟡 중간 |
| **비용**          | 임베딩/추론 시 토큰 비용 증가 (8개 청크에 한정, 전체 대비 0.4% 미만)                       | 🟢 경미 |
| **검색 노이즈**   | 주석 30개가 한 청크에 몰린 경우, 의미적으로 무관한 주석이 함께 검색될 수 있음              | 🟡 중간 |

### 대응 방안 (필요 시)

Phase 2에서 검색 품질 평가 후, 특정 청크의 검색 정확도가 낮으면 그때 분할 적용 가능.

---

## 이슈 3: 테이블 파싱 실패 36개

### 현황

- 전체 HTML 테이블: 2,991개
- 파싱 성공: 2,955개 (**98.80%**)
- 파싱 실패: **36개** (1.20%)

### 원인

복잡한 `rowspan`/`colspan` 합병 셀 구조, 빈 `<tbody>` 테이블, 비정형 HTML 등

### 영향

- 실패한 테이블의 데이터는 텍스트로 포함되어 있으므로 완전 손실은 아님
- 엔티티 추출 시 해당 테이블에서 자동 추출 불가 → LLM 폴백 필요

### 결정: 현 상태 유지 (Phase 2에서 LLM 폴백으로 대응)

---

## 이슈 4: 빈 청크 2개

| Chunk ID | 원인                          |
| -------- | ----------------------------- |
| C-0759   | SECTION 마커만 있고 본문 없음 |
| C-1149   | SECTION 마커만 있고 본문 없음 |

**영향**: 0.1% (2/2,042) — 임베딩 시 자동 제외 처리 가능

---

## 해결 방안 요약 (최종)

| 문제                  | 해결 방법                        | 상태        | 우선순위      |
| --------------------- | -------------------------------- | ----------- | ------------- |
| 1개 미매핑 (CONTEXT)  | CONTEXT 마커 섹션 처리 로직 추가 | 미해결      | 🟡 Phase 2 전  |
| 14개 미매핑 (파일명)  | `943-948 OK.md` → `OKOK` 변경    | 미시행      | 🟡 파일명 변경 |
| 8개 초과 청크         | **유지 결정**                    | ✅ 결정 완료 | —             |
| 36개 테이블 파싱 실패 | LLM 폴백 (Phase 2)               | 수용        | 🟢 낮음        |
| 2개 빈 청크           | 임베딩 시 제외                   | 수용        | 🟢 낮음        |

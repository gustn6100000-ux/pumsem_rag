# 건설공사 표준품셈 GraphRAG 구축 검토 보고서

## 1. 데이터 현황 분석

### 1.1 원본 문서 개요
- **문서명**: 건설공사 표준품셈
- **전체 규모**: 약 898페이지 본문 + 48페이지 목차 (총 ~950페이지)
- **5대 부문 구성**:

| 부문 | 장(Chapter) 수 | 페이지 범위 | 주요 내용 |
|------|--------------|------------|----------|
| 공통부문 | 제1~8장 | p.3~293 | 적용기준, 가설, 토공, 기초, 콘크리트, 돌, 건설기계 등 |
| 토목부문 | 제1~9장 | p.299~542 | 도로포장, 하천, 터널, 교량, 상하수도, 측량 등 |
| 건축부문 | 제1~11장 | p.545~616 | 철골, 조적, 타일, 목공, 수장, 방수, 금속, 칠공사 등 |
| 기계설비부문 | 제1~13장 | p.621~827 | 배관, 덕트, 보온, 펌프, 소방, 플랜트 등 |
| 유지관리부문 | 제1~4장 | p.831~898 | 토공, 도로, 건축, 기계설비 유지보수 |

### 1.2 파싱 완료 데이터 (전체 100%)

#### 부문별 파일 현황

**공통부문 (8개 파일, 7개 장)**

| 파일명 | PDF 페이지 | 줄 수 | 용량 | 커버 영역 |
|--------|-----------|-------|------|----------|
| 20260206_53-83_p1-15.md | 53~67 | 2,130 | 59KB | 제1장 적용기준 |
| 20260206_53-83_p16-22.md | 68~74 | 1,142 | 29KB | 제1장 적용기준 |
| 20260206_53-83_p17-31.md | 69~83 | 1,949 | 58KB | 제1장 적용기준 |
| 20260207_84-113.md | 84~113 | 5,451 | 128KB | 제2장 가설공사 |
| 20260207_114-143.md | 114~143 | 5,066 | 99KB | 제3장 토공사 |
| 20260207_144-168.md | 144~168 | 4,368 | 99KB | 제5장 기초공사 |
| 20260208_170-199.md | 170~199 | 4,800 | 127KB | 제6장 철근콘크리트공사 |
| 20260208_201-204.md | 201~204 | 647 | 15KB | 제7장 돌공사 |
| 20260208_205-345.md | 205~345 | 30,203 | 683KB | 제8장 건설기계 |

**토목부문 (6개 파일, 9개 장)**

| 파일명 | PDF 페이지 | 줄 수 | 용량 | 커버 영역 |
|--------|-----------|-------|------|----------|
| 20260208_349-373.md | 349~373 | 4,293 | 112KB | 제1장 도로포장공사 |
| 20260208_375-395.md | 375~395 | 3,046 | 78KB | 제2장 하천공사 |
| 20260208_397-427.md | 397~427 | 5,769 | 138KB | 제5장 강구조공사 |
| 20260208_429-438.md | 429~438 | 1,737 | 38KB | 제7장 항만공사 |
| 20260208_439-447.md | 439~447 | 1,926 | 43KB | 제8장 지반조사 |
| 20260208_449-592.md | 449~592 | 26,272 | 652KB | 제9장 측량 외 |

**건축부문 (10개 파일, 11개 장)**

| 파일명 | PDF 페이지 | 줄 수 | 용량 | 커버 영역 |
|--------|-----------|-------|------|----------|
| 20260208_595-603.md | 595~603 | 1,923 | 47KB | 제1장 철골공사 |
| 20260208_605-613.md | 605~613 | 1,314 | 35KB | 제2장 조적공사 |
| 20260208_615-618.md | 615~618 | 2,475 | 55KB | 제4장 목공사 |
| 20260208_619-628.md | 619~628 | 1,851 | 41KB | 제5장 수장공사 |
| 20260208_629-635.md | 629~635 | 1,209 | 28KB | 제6장 방수공사 |
| 20260208_637-641.md | 637~641 | 771 | 20KB | 제7장 지붕 및 홈통공사 |
| 20260208_643-647.md | 643~647 | 871 | 21KB | 제8장 금속공사 |
| 20260208_649-653.md | 649~653 | 888 | 20KB | 제9장 미장공사 |
| 20260208_655-659.md | 655~659 | 985 | 23KB | 제10장 창호 및 유리공사 |
| 20260208_661-666.md | 661~666 | 1,023 | 28KB | 제11장 칠공사 |

**기계설비부문 (12개 파일, 13개 장)**

| 파일명 | PDF 페이지 | 줄 수 | 용량 | 커버 영역 |
|--------|-----------|-------|------|----------|
| 20260208_671-683.md | 671~683 | 1,851 | 45KB | 제1장 배관공사 |
| 20260208_685-689.md | 685~689 | 964 | 23KB | 제2장 덕트공사 |
| 20260208_691-695.md | 691~695 | 851 | 21KB | 제3장 보온공사 |
| 20260208_697-699.md | 697~699 | 614 | 15KB | 제4장 펌프 및 공기설비공사 |
| 20260208_701-703.md | 701~703 | 461 | 12KB | 제5장 밸브설비공사 |
| 20260208_705-711.md | 705~711 | 1,052 | 26KB | 제6장 측정기기공사 |
| 20260208_713-724.md | 713~724 | 2,444 | 53KB | 제8장 공기조화설비공사 |
| 20260208_725-729.md | 725~729 | 878 | 24KB | 제9장 기타공사 |
| 20260208_731-736.md | 731~736 | 988 | 23KB | 제10장 소방설비공사 |
| 20260208_737-740.md | 737~740 | 796 | 18KB | 제11장 가스설비공사 |
| 20260208_741-746.md | 741~746 | 1,269 | 28KB | 제12장 자동제어설비공사 |
| 20260208_747-878.md | 747~878 | 29,746 | 659KB | 제13장 플랜트설비공사 |

**유지관리부문 (4개 파일, 4개 장)**

| 파일명 | PDF 페이지 | 줄 수 | 용량 | 커버 영역 |
|--------|-----------|-------|------|----------|
| 20260208_881-896.md | 881~896 | 2,838 | 71KB | 제1장 공통 |
| 20260208_897-932.md | 897~932 | 6,422 | 165KB | 제2장 토목 |
| 20260208_933-942.md | 933~942 | 1,329 | 33KB | 제3장 건축 |
| 20260208_943-948.md | 943~948 | 1,058 | 26KB | 제4장 기계설비 |

#### 종합 통계

- **파싱 완료**: 전체 898페이지 본문 (100%)
- **총 파일 수**: 41개 MD 파일 (5개 부문 전체)
- **총 데이터 용량**: 3.8MB
- **총 줄 수**: 165,670줄

### 1.3 메타데이터 현황

| 항목 | 상태 | 내용 |
|------|------|------|
| toc_parsed.json | 완료 | 1,284개 섹션의 구조화된 목차 (474KB) |
| 목차_gemini.md | 완료 | 전체 목차 원문 (274KB) |
| 섹션 매핑 | 완료 | 섹션ID → {부문, 장, 제목, 페이지} |
| 페이지 매핑 | 완료 | 페이지번호 → 섹션 목록 |

### 1.4 데이터 구조 품질 평가

**매우 우수 (GraphRAG 구축에 최적)**

현재 MD 파일들은 다음과 같은 구조화된 메타데이터를 이미 포함:

```markdown
<!-- PAGE 1 | 공통부문 > 제1장 적용기준 -->
<!-- SECTION: 1-1 | 일반사항 | 부문:공통부문 | 장:제1장 적용기준 -->
<!-- SECTION: 1-1-1 | 목적 | 부문:공통부문 | 장:제1장 적용기준 -->
```

- 페이지별 부문/장 태그
- 섹션별 계층적 번호 (X-Y-Z 3단계)
- HTML 테이블로 정형화된 품셈 데이터
- 주석([주]) 및 비고 형태의 보충 정보

---

## 2. GraphRAG 구축 가능성 결론

### **결론: 구축 가능하며, 매우 적합한 데이터 구조**

### 2.1 적합성 근거

| 평가 항목 | 점수 | 근거 |
|-----------|------|------|
| 엔티티 추출 가능성 | ★★★★★ | 공종/자재/장비/인력이 명확히 구분됨 |
| 관계 추출 가능성 | ★★★★☆ | 테이블 구조에서 자동 추출 가능, 교차참조 존재 |
| 계층 구조 | ★★★★★ | 부문→장→절→항 4단계 계층 완벽 구조화 |
| 메타데이터 풍부도 | ★★★★★ | toc_parsed.json으로 1,284개 섹션 매핑 완료 |
| 데이터 정형화 수준 | ★★★★☆ | HTML 테이블+텍스트 혼합, 파싱 가능 |
| 질의 응답 활용도 | ★★★★★ | 건설 현장의 실질적 Q&A에 매우 유용 |

### 2.2 전체 데이터 파싱 완료에 따른 즉시 구축 가능성

1. **5개 부문 전체 파싱 완료**: 공통/토목/건축/기계설비/유지관리 부문 898페이지 전량 MD 변환 완료
2. **목차-본문 매핑 완전**: toc_parsed.json 1,284개 섹션과 41개 MD 파일이 SECTION/CONTEXT 마커로 완전 매핑
3. **데이터 품질 검증 완료**: 전 파일에 대해 누락 마커 수동 보정 작업까지 완료
4. **즉시 Phase 1 착수 가능**: 추가 파싱 대기 없이 전처리 파이프라인 구축 즉시 시작 가능

### 2.3 예상되는 주요 활용 시나리오

| 질의 유형 | 예시 | 난이도 |
|-----------|------|--------|
| 품셈 조회 | "콘크리트 타설 시 필요한 인력과 장비는?" | 기본 |
| 조건별 조회 | "깊이 3m 이상 굴착 시 할증률은?" | 중간 |
| 교차참조 | "H-Beam 관련 모든 공종을 알려줘" | 중간 |
| 비교 분석 | "인력타설 vs 장비타설 시공량 차이는?" | 고급 |
| 종합 산출 | "옹벽 시공 시 필요한 전체 품셈 항목은?" | 고급 |
| 규정 연계 | "소음진동 관련 할증이 적용되는 공종은?" | 고급 |

---

## 3. 그래프 구조 설계

### 3.1 노드(Node) 타입 정의

```
[엔티티 타입]          [예시]                         [추출 소스]
─────────────────────────────────────────────────────────────────
Department(부문)     공통부문, 토목부문, 건축부문...     toc_parsed.json
Chapter(장)          제1장 적용기준, 제2장 가설공사...    toc_parsed.json
Section(절)          1-1 일반사항, 3-2 굴착...          toc_parsed.json + MD
Subsection(항)       3-2-1 굴착(인력/토사)...           toc_parsed.json + MD
WorkType(공종)       콘크리트 타설, 돌쌓기, 터파기...     MD 본문 파싱
Material(자재)       콘크리트, 철근, H-Beam, 마대...     테이블 파싱
Equipment(장비)      굴착기, 불도저, 덤프트럭...         테이블 파싱
Labor(인력)          콘크리트공, 보통인부, 특별인부...     테이블 파싱
Specification(규격)  0.6m³, 15톤, 25t...               테이블 파싱
Rate(품/시공량)      인당 3.6m³, 일당 55m³...           테이블 파싱
Condition(조건)      깊이, 토질, 지형, 용수...           주석/비고 파싱
Surcharge(할증)      33% 감산, 40% 가산, 50% 감...      주석/비고 파싱
Regulation(법규)     소방법, 산업안전보건법...             본문 파싱
```

### 3.2 엣지(Edge/Relationship) 타입 정의

```
[관계]                    [from → to]                    [속성]
──────────────────────────────────────────────────────────────────
BELONGS_TO              Section → Chapter               계층 관계
PART_OF                 Chapter → Department             계층 관계
REQUIRES_MATERIAL       WorkType → Material              수량, 단위
USES_EQUIPMENT          WorkType → Equipment             시간, 대수
NEEDS_LABOR             WorkType → Labor                 인수, 공종
HAS_SPECIFICATION       Equipment/Material → Spec        규격
HAS_RATE                WorkType → Rate                  시공량, 단위당
APPLIES_CONDITION       Surcharge → WorkType             조건, 비율
REFERENCES              Section → Section                교차참조
REGULATED_BY            WorkType → Regulation            적용 법규
VARIANT_OF              WorkType → WorkType              인력식↔기계식
FOLLOWS                 Section → Section                순서 관계
```

### 3.3 예상 그래프 규모 (전체 데이터 기준)

| 항목 | 예상 수량 | 추출 소스 |
|------|----------|----------|
| Department 노드 | 5 | toc_parsed.json |
| Chapter 노드 | ~45 | toc_parsed.json |
| Section 노드 | 1,284 | toc_parsed.json + MD SECTION 마커 |
| WorkType 노드 | ~500 | MD 본문 파싱 |
| Material 노드 | ~300 | 테이블 파싱 |
| Equipment 노드 | ~200 | 테이블 파싱 |
| Labor 노드 | ~50 | 테이블 파싱 |
| Rate 노드 | ~2,000 | 테이블 파싱 |
| **총 노드** | **~4,400** | |
| **총 엣지** | **~12,000** | |

---

## 4. 기술 아키텍처 설계

### 4.1 전체 파이프라인

```
[Phase 1: 데이터 전처리]
    MD 파일들 → 섹션 분할 → 텍스트/테이블 분리 → 청크 생성

[Phase 2: 엔티티 & 관계 추출]
    LLM(Gemini/Claude) → 엔티티 추출 → 관계 추출 → 검증

[Phase 3: 그래프 구축]
    엔티티/관계 → Neo4j 그래프DB 저장 → 인덱싱

[Phase 4: 임베딩 & 벡터 저장]
    텍스트 청크 → 임베딩 생성 → ChromaDB/Qdrant 저장

[Phase 5: GraphRAG 서빙]
    사용자 질의 → 그래프 탐색 + 벡터 검색 → 컨텍스트 조합 → LLM 응답
```

### 4.2 기술 스택 옵션

#### Option A: Microsoft GraphRAG (추천)

```
- 프레임워크: microsoft/graphrag
- 장점: 커뮤니티 요약, 글로벌/로컬 검색 지원
- 그래프 저장: 내장 parquet / Neo4j 연동
- 임베딩: OpenAI / Azure OpenAI
- LLM: GPT-4o / Claude
```

#### Option B: LlamaIndex + Neo4j (유연성 최고)

```
- 프레임워크: LlamaIndex PropertyGraphIndex
- 그래프 DB: Neo4j Community Edition (무료)
- 임베딩: OpenAI / HuggingFace 한국어 모델
- LLM: Claude API / Gemini API
- 검색: 그래프 순회 + 벡터 하이브리드
```

#### Option C: LangChain + Neo4j (생태계 풍부)

```
- 프레임워크: LangChain GraphQAChain
- 그래프 DB: Neo4j
- 임베딩: OpenAI text-embedding-3-small
- LLM: Claude / GPT-4o
- 검색: Cypher 쿼리 생성 + 벡터 검색
```

### 4.3 추천 조합

**LlamaIndex + Neo4j (Option B) 추천**

이유:
1. 한국어 엔티티 추출에 대한 커스터마이징 용이
2. PropertyGraphIndex가 이 데이터의 계층 구조에 최적
3. Neo4j의 Cypher 쿼리로 복잡한 관계 질의 가능
4. 기존 Gemini API 키 활용 가능

---

## 5. 상세 구현 계획

### Phase 1: 데이터 전처리 파이프라인 (1~2주)

> **현황**: PDF→MD 파싱 100% 완료 (41개 파일, 165,670줄, 3.8MB). SECTION/CONTEXT 마커 보정 완료.
> 이 단계에서는 완성된 MD 파일을 GraphRAG용 구조화 데이터로 변환한다.

#### Step 1.1: MD 파일 섹션 파서 구축
```python
# 목표: 41개 MD 파일을 섹션 단위로 분할하고 구조화
# 입력: download_file/*.md (41개 파일, 5개 부문 전체)
# 출력: sections.json (섹션별 텍스트+메타데이터)

작업 내용:
1. <!-- SECTION: --> / <!-- CONTEXT: --> 태그 기반 섹션 분할
2. <!-- PAGE --> 태그 기반 페이지 매핑
3. HTML <table> 파싱 → 구조화된 dict 변환
4. [주] 및 비고 추출
5. toc_parsed.json(1,284개 섹션)과 매핑하여 메타데이터 보강
```

#### Step 1.2: 청크 전략 수립
```
- 기본 단위: 섹션(항) 단위 = 1 청크
- 테이블 포함 섹션: 테이블 + 주석을 하나의 청크로 유지
- 대형 섹션: 1,500토큰 기준으로 분할 (의미 단위 유지)
- 메타데이터 포함: 부문, 장, 절, 항, 페이지번호
- 예상 청크 수: ~1,500개 (전체 데이터 기준)
```

### Phase 2: 엔티티 & 관계 추출 (2~3주)

#### Step 2.1: 테이블 기반 자동 추출 (높은 정확도)
```
HTML 테이블에서 자동 추출 가능한 항목:
- 인력 타입 + 수량 (예: 콘크리트공 3인, 보통인부 1인)
- 장비 타입 + 규격 + 수량 (예: 굴착기 0.6m³ 1대)
- 시공량 (예: 무근구조물 63m³, 철근구조물 55m³)
- 단위 (일당, m³당, m²당, 개당 등)
```

#### Step 2.2: LLM 기반 엔티티 추출 (텍스트 영역)
```
프롬프트 설계:
- 공종명 추출: "이 텍스트에서 건설 공종(작업)을 모두 추출하시오"
- 자재명 추출: "이 텍스트에서 건설 자재/재료를 모두 추출하시오"
- 조건 추출: "이 텍스트에서 할증/감산 조건을 모두 추출하시오"
- 교차참조 추출: "이 텍스트에서 다른 섹션 참조를 모두 추출하시오"

모델: Gemini 2.0 Flash (비용 효율) 또는 Claude Haiku
배치 처리: 섹션 단위로 병렬 처리
```

#### Step 2.3: 관계 추출 및 검증
```
1. 규칙 기반 관계 (테이블 → 공종-인력-장비 삼각관계)
2. LLM 기반 관계 (텍스트에서 참조/조건 관계)
3. 수동 검증: 샘플 100건 정확도 확인 (목표: 90% 이상)
```

### Phase 3: 그래프 DB 구축 (1주)

#### Step 3.1: Neo4j 스키마 설계
```cypher
// 노드 생성 예시
CREATE (d:Department {name: '공통부문'})
CREATE (c:Chapter {id: '제1장', name: '적용기준', department: '공통부문'})
CREATE (s:Section {id: '1-1-1', name: '목적', page: 3})
CREATE (w:WorkType {name: '레디믹스트콘크리트 타설', section_id: '6-1-1'})
CREATE (m:Material {name: '레디믹스트콘크리트'})
CREATE (e:Equipment {name: '굴착기', spec: '0.6~0.8m³'})
CREATE (l:Labor {name: '콘크리트공'})
CREATE (r:Rate {value: 55, unit: 'm³', basis: '일당', type: '철근구조물'})

// 관계 생성 예시
CREATE (w)-[:NEEDS_LABOR {count: 3, unit: '인'}]->(l)
CREATE (w)-[:USES_EQUIPMENT {count: 1, unit: '대'}]->(e)
CREATE (w)-[:HAS_RATE]->(r)
CREATE (s)-[:BELONGS_TO]->(c)
CREATE (c)-[:PART_OF]->(d)
```

#### Step 3.2: 데이터 로딩
```
- Neo4j Community Edition (Docker)
- Python neo4j 드라이버로 bulk import
- 인덱스: 노드 이름, 섹션 ID, 페이지 번호
```

### Phase 4: 벡터 임베딩 구축 (1주)

#### Step 4.1: 임베딩 생성
```
- 모델: text-embedding-3-small (OpenAI) 또는
        ko-sroberta-multitask (한국어 특화)
- 대상: 섹션별 텍스트 청크 + 테이블 텍스트화
- 저장: ChromaDB (로컬) 또는 Qdrant
- 메타데이터 필터: 부문, 장, 페이지번호
```

#### Step 4.2: 하이브리드 검색 설계
```
1. 벡터 유사도 검색 → Top-K 관련 청크
2. 청크의 섹션 ID → Neo4j 그래프 탐색
3. 연결된 공종/자재/장비 노드 수집
4. 관련 교차참조 섹션 추가 수집
5. 통합 컨텍스트 조합 → LLM에 전달
```

### Phase 5: RAG 서빙 인터페이스 (1~2주)

#### Step 5.1: 질의 처리 파이프라인
```python
def process_query(query: str):
    # 1. 질의 분석 (의도 파악)
    intent = classify_intent(query)  # 품셈조회/조건질의/비교/종합

    # 2. 그래프 검색 (엔티티 매칭)
    graph_results = neo4j_search(query, intent)

    # 3. 벡터 검색 (의미 유사도)
    vector_results = vector_search(query, top_k=5)

    # 4. 컨텍스트 통합
    context = merge_results(graph_results, vector_results)

    # 5. LLM 응답 생성
    response = llm_generate(query, context)
    return response
```

#### Step 5.2: UI (선택)
```
- Streamlit 기반 웹 인터페이스
- 채팅 형태 Q&A
- 그래프 시각화 (vis.js 또는 neovis.js)
- 원문 참조 링크 제공
```

---

## 6. 리소스 및 비용 예상

### 6.1 인프라

| 항목 | 선택지 | 비용 |
|------|--------|------|
| Neo4j | Community Edition (Docker) | 무료 |
| 벡터 DB | ChromaDB (로컬) | 무료 |
| LLM (추출용) | Gemini 2.0 Flash | 기존 API 키 활용 |
| LLM (서빙용) | Claude / GPT-4o | 질의당 ~$0.01~0.05 |
| 임베딩 | text-embedding-3-small | ~$0.02/1M 토큰 |
| 서버 | 로컬 PC (현재 환경) | 무료 |

### 6.2 예상 API 비용 (1회성 구축)

| 작업 | 토큰 수 | 예상 비용 |
|------|---------|----------|
| 엔티티 추출 (전체) | ~2M 입력 토큰 | ~$0.30 (Gemini Flash) |
| 관계 추출 (전체) | ~2M 입력 토큰 | ~$0.30 (Gemini Flash) |
| 임베딩 생성 | ~1M 토큰 | ~$0.02 |
| **구축 총 비용** | | **~$1 미만** |

### 6.3 일정 요약

| 단계 | 기간 | 비고 |
|------|------|------|
| ~~PDF→MD 파싱~~ | ~~완료~~ | **41개 파일, 3.8MB 완료** |
| Phase 1: 전처리 | 1~2주 | 전체 데이터 대상 섹션 분할/청킹 |
| Phase 2: 추출 | 2~3주 | LLM 프롬프트 튜닝 포함 |
| Phase 3: 그래프 구축 | 1주 | |
| Phase 4: 임베딩 | 1주 | |
| Phase 5: 서빙 | 1~2주 | |
| **총 예상 기간** | **6~9주** | 병렬 진행 가능, 파싱 대기 없음 |

---

## 7. 데이터 품질 현황 및 잔여 과제

### 7.1 파싱 완료 후 데이터 품질 현황

| 항목 | 상태 | 비고 |
|------|------|------|
| PDF→MD 변환 | ✅ 완료 | 41개 파일, 898페이지, 5개 부문 전체 |
| SECTION/CONTEXT 마커 | ✅ 보정 완료 | 짝수 페이지 누락분 수동 삽입 완료 |
| toc 매핑 | ✅ 완료 | 1,284개 섹션 매핑 |
| 테이블 파싱 품질 | ⚠️ 일부 불균일 | 복잡한 테이블 구조 깨짐 가능 → 검증 로직 필요 |
| PDF↔문서 페이지 매핑 | ⚠️ 오프셋 존재 | PDF 페이지 ≠ 문서 쪽번호 (약 52페이지 오프셋) |

### 7.2 GraphRAG 구축 시 잔여 과제

| 과제 | 영향 | 대응 방안 |
|------|------|----------|
| 테이블 파싱 품질 불균일 | 엔티티 추출 정확도 저하 | HTML 테이블 구조 검증 로직 추가 |
| 일부 교차참조 텍스트 해석 | 참조 관계 누락 가능 | LLM 기반 교차참조 추출 시 프롬프트 보강 |
| PDF↔문서 페이지 매핑 | 원문 참조 링크 불일치 | 파일별 오프셋 매핑 테이블 구축 |
| 짝수 페이지 푸터 인식 | 자동 파서의 구조적 한계 | 향후 파서 개선 시 짝수 페이지 푸터 패턴 추가 |

---

## 8. n8n 워크플로우 자동화 연동 방안

### 8.1 결론: n8n과 GraphRAG 결합은 충분히 가능하며, 실용적인 선택

n8n은 오픈소스 워크플로우 자동화 플랫폼으로, GraphRAG 파이프라인의 **자동화, 오케스트레이션, 서빙** 전 과정을 시각적으로 구성할 수 있다. 2026년 현재 n8n의 AI/RAG 생태계가 성숙하여 GraphRAG 연동 사례와 템플릿이 다수 공개되어 있다.

### 8.2 n8n의 GraphRAG 관련 통합 현황

| 구성 요소 | n8n 지원 현황 | 비고 |
|-----------|-------------|------|
| **Neo4j** | 커뮤니티 노드 (n8n-nodes-neo4j by Kurea) | 벡터 스토어+그래프 DB 연산 지원, 주간 1,400+ 다운로드 |
| **Qdrant** | 공식 노드 제공 | 문서 삽입, 검색, AI 에이전트 도구 연결 가능 |
| **Pinecone** | 공식 노드 제공 | 문서 삽입, 검색, 체인 연결 지원 |
| **ChromaDB** | HTTP Request 노드로 연동 | 공식 노드 미제공, REST API 통한 커스텀 연동 |
| **LangChain** | 네이티브 통합 | n8n이 LangChain 기능을 구현하는 노드 컬렉션 제공 |
| **LlamaIndex** | LangChain 통해 상호 운용 | LlamaIndex 쿼리 엔진을 LangChain 도구로 통합 가능 |
| **LLM** | OpenAI, Claude, Gemini, Ollama 등 | 다수 LLM 공식 노드 제공 |
| **임베딩** | OpenAI, HuggingFace 등 | 공식 임베딩 노드 제공 |

### 8.3 n8n + GraphRAG 아키텍처 설계

```
[n8n 워크플로우 자동화 파이프라인]

┌─────────────────────────────────────────────────────────────────┐
│  Workflow 1: 데이터 수집 & 전처리 (스케줄/트리거 기반)            │
│                                                                 │
│  파일 감시 → MD 파싱 → 섹션 분할 → 엔티티/관계 추출(LLM)         │
│      ↓              ↓                    ↓                      │
│  [Google Drive]  [Code Node]     [Claude/Gemini API]            │
└─────────────────────┬───────────────────┬───────────────────────┘
                      ↓                   ↓
┌─────────────────────────────────────────────────────────────────┐
│  Workflow 2: 그래프 & 벡터 저장                                  │
│                                                                 │
│  엔티티/관계 → Neo4j 그래프 저장    텍스트 청크 → 임베딩 → Qdrant  │
│                  ↓                                ↓              │
│          [Neo4j 커뮤니티 노드]            [Qdrant 공식 노드]      │
└─────────────────────┬───────────────────┬───────────────────────┘
                      ↓                   ↓
┌─────────────────────────────────────────────────────────────────┐
│  Workflow 3: 질의 응답 서빙 (웹훅 트리거)                        │
│                                                                 │
│  웹훅 수신 → 의도 분류 → 그래프 탐색 + 벡터 검색 → LLM 응답 생성  │
│      ↓          ↓              ↓                    ↓           │
│  [Webhook]  [AI Agent]   [Neo4j + Qdrant]    [Claude/GPT-4o]   │
│                                                    ↓            │
│                                              웹훅 응답 반환      │
└─────────────────────────────────────────────────────────────────┘
```

### 8.4 n8n 활용 시나리오별 워크플로우

#### 시나리오 1: 데이터 자동 수집 & 그래프 갱신

```
[트리거: Google Drive 파일 변경 감지 또는 스케줄]
    → 새 MD 파일 감지
    → Code 노드에서 섹션 분할 & 테이블 파싱
    → LLM 노드에서 엔티티/관계 추출
    → Neo4j 노드에서 그래프 업데이트 (Cypher 실행)
    → Qdrant 노드에서 벡터 임베딩 저장
    → Slack/이메일로 업데이트 알림
```

#### 시나리오 2: 품셈 질의응답 챗봇

```
[트리거: 웹훅 (채팅 위젯에서 질문 수신)]
    → AI Agent 노드 (의도 분류 + 도구 선택)
        → 도구 1: Neo4j 쿼리 (그래프 탐색)
        → 도구 2: Qdrant 검색 (벡터 유사도)
    → 컨텍스트 조합
    → LLM 응답 생성 (원문 출처 포함)
    → 웹훅 응답 반환
```

#### 시나리오 3: 품셈 비교/분석 보고서 자동 생성

```
[트리거: 수동 실행 또는 API 호출]
    → 비교 대상 공종 입력
    → Neo4j에서 관련 노드/관계 추출
    → LLM으로 비교 분석 수행
    → HTML/PDF 보고서 생성
    → Google Drive에 저장 또는 이메일 발송
```

### 8.5 n8n 기존 GraphRAG 템플릿 활용

n8n 커뮤니티에 이미 공개된 GraphRAG 관련 워크플로우 템플릿:

| 템플릿 | 활용 방안 |
|--------|----------|
| **Chat with PDF/MD Files using GraphRAG** (워크플로우 #4755) | MD 파일 기반 GraphRAG 채팅 — 본 프로젝트에 직접 적용 가능 |
| **Custom reasoning with GraphRAG & knowledge ontology** (#6816) | 품셈 온톨로지 기반 추론 패턴 구성에 참고 |
| **AI Chatbot with InfraNodus GraphRAG** (#4402) | 전문가 패널 기반 챗봇 구조 참고 |
| **GraphRAG with Neo4j and Qdrant on n8n** (커뮤니티) | Neo4j+Qdrant 하이브리드 검색 구현에 직접 참고 |

### 8.6 n8n 연동 시 기술 스택 조합

```
[권장 스택: n8n + LlamaIndex + Neo4j + Qdrant]

                    ┌─────────────┐
                    │    n8n      │  ← 워크플로우 오케스트레이션
                    │  (자동화)    │     스케줄링, 트리거, 웹훅
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              ↓            ↓            ↓
       ┌──────────┐ ┌──────────┐ ┌──────────┐
       │LlamaIndex│ │  Neo4j   │ │  Qdrant  │
       │(인덱싱)   │ │(그래프DB) │ │(벡터DB)  │
       └──────────┘ └──────────┘ └──────────┘
              ↑            ↑            ↑
              └────────────┼────────────┘
                           │
                    ┌──────┴──────┐
                    │ Claude API  │  ← 엔티티 추출 + 응답 생성
                    │ / Gemini    │
                    └─────────────┘
```

**역할 분담**:
- **n8n**: 전체 파이프라인 오케스트레이션, 스케줄링, 트리거, 웹훅 서빙, 채팅 위젯
- **LlamaIndex**: 문서 인덱싱, PropertyGraphIndex로 그래프 구조화
- **Neo4j**: 그래프 저장 및 Cypher 쿼리
- **Qdrant**: 벡터 임베딩 저장 및 유사도 검색
- **Claude/Gemini API**: 엔티티 추출, 관계 추출, 응답 생성

### 8.7 n8n 연동의 장점과 고려사항

#### 장점

| 항목 | 설명 |
|------|------|
| **시각적 파이프라인 관리** | 코드 없이 GraphRAG 전 과정을 시각적으로 설계/수정 가능 |
| **자동화 & 스케줄링** | 데이터 갱신, 그래프 업데이트를 자동 트리거로 처리 |
| **빠른 프로토타이핑** | 기존 템플릿을 수정하여 빠르게 파일럿 구축 가능 |
| **웹훅 기반 서빙** | Streamlit 없이도 n8n 웹훅+채팅 위젯으로 서빙 가능 |
| **500+ 통합** | Google Drive, Slack, 이메일 등 외부 서비스 연동 용이 |
| **셀프 호스팅** | Docker로 사내 서버에 배포 가능 (데이터 보안) |
| **비개발자 접근성** | 건설 도메인 전문가가 직접 워크플로우 수정 가능 |

#### 고려사항

| 항목 | 설명 | 대응 방안 |
|------|------|----------|
| Neo4j 공식 노드 미제공 | 커뮤니티 노드에 의존 | Kurea 노드가 안정적이며 활발히 유지보수 중 |
| 복잡한 전처리 로직 | n8n Code 노드만으로는 한계 | Python 스크립트를 n8n Execute Command 노드로 호출 |
| 한국어 처리 | 한국어 특화 설정 필요 | LLM의 한국어 능력 활용 + 커스텀 프롬프트 |
| 대용량 배치 처리 | n8n은 실시간 처리에 최적화 | 초기 대량 적재는 Python 스크립트, 이후 증분 업데이트를 n8n으로 |
| 디버깅 복잡도 | 여러 노드 간 데이터 흐름 추적 | n8n의 실행 로그 및 각 노드별 출력 확인 기능 활용 |

### 8.8 구현 로드맵 (n8n 연동 포함)

```
[Phase 1~4: 기존 계획대로 Python 기반 GraphRAG 구축]
    ↓
[Phase 5-A: n8n 연동 (기존 Phase 5 대체/보완)]

  Step 5-A.1: n8n 환경 구축 (Docker)
      → n8n + Neo4j + Qdrant Docker Compose 구성

  Step 5-A.2: 데이터 갱신 워크플로우 구축
      → Google Drive 파일 감시 → 전처리 → 그래프/벡터 업데이트

  Step 5-A.3: 질의응답 워크플로우 구축
      → 기존 GraphRAG 템플릿(#4755) 기반으로 커스터마이징
      → AI Agent 노드 + Neo4j + Qdrant 하이브리드 검색

  Step 5-A.4: 챗봇 인터페이스 배포
      → n8n 웹훅 + @n8n/chat 위젯으로 웹 채팅 구현
      → 또는 기존 사내 시스템에 API 연동
```

---

## 9. 최종 권장사항

### 즉시 착수 (데이터 준비 완료)
1. **Phase 1 전처리 파이프라인**: 41개 MD 파일 전체를 대상으로 섹션 분할 및 청킹 구축
2. **소규모 파일럿**: 공통부문 제1장 적용기준 + 토목부문 제1장 도로포장공사로 부문 간 end-to-end 검증
3. **프롬프트 튜닝**: 한국어 건설 용어에 최적화된 엔티티 추출 프롬프트 개발

### 파이프라인 검증 후 전체 구축
4. 5개 부문 전체 데이터에 파이프라인 일괄 적용
5. 그래프 품질 검증 및 보정 (교차참조, 테이블 파싱 오류 수정)
6. **n8n 워크플로우 구축**: 기존 GraphRAG 템플릿(#4755) 기반으로 질의응답 워크플로우 구성
7. **n8n 챗봇 배포**: 웹훅 + 채팅 위젯으로 사내 서빙 인터페이스 구축

### 장기적으로 고려할 것
8. 연도별 품셈 변경 이력 추적 (버전 관리)
9. 실적 데이터와의 연동 (실제 비용 vs 품셈 비교)
10. 다른 문서(설계기준, 시방서 등)와의 통합 그래프
11. **n8n 데이터 갱신 자동화**: Google Drive 파일 변경 감지 → 자동 그래프 업데이트 파이프라인

---

*작성일: 2026-02-08*
*데이터 기준: download_file/ 내 41개 MD 파일 (전체 파싱 완료) + toc_parsed.json*

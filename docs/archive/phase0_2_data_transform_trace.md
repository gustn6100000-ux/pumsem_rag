# Phase 0-2: 데이터 변형 경로 추적 결과

**실행 스크립트**: `trace_data_transform.py`
**실행일**: 2026-02-12
**대상 섹션**: 13-2-3 (강관용접)

---

## 파이프라인 단계별 데이터 현황

| 단계 | 파일 | 엔티티 수 | WorkType | 관계 수 |
| --- | --- | ---: | ---: | ---: |
| step1 (규칙) | table_entities.json | 18 | 0 | 7 |
| step2 (LLM) | llm_entities.json | 169 | 110 | 214 |
| step3 (병합) | merged_entities.json | 171 | 98 | 319 |
| step4 (정규화) | normalized_entities.json | 171 | 98 | 289 |

---

## 핵심 기대값 추적 결과

### φ200 SCH 20 → 용접공 (기대값: 0.287)

| 단계 | 결과 | qty |
| --- | :---: | ---: |
| step1 | NOT_FOUND | - |
| step2 (entity) | MISMATCH | None |
| step2 (rel) | **MATCH** | **0.287** |
| step3 (rel) | MATCH | 0.287 |
| step4 (rel) | MATCH | 0.287 |

> ✅ 이 값만 정확. 하지만 entity qty는 None (할루시네이션).

### φ200 SCH 40 → 플랜트 용접공 (기대값: 0.287)

| 단계 | 결과 | qty | 비고 |
| --- | :---: | ---: | --- |
| step2 (entity) | MISMATCH | None | |
| step2 (rel) | **MISMATCH** | **0.294** | ❌ 값 오류 |
| step3 (rel) | MISMATCH | 0.294 | 변형 없음 |
| step4 (rel) | MISMATCH | 0.294 | 변형 없음 |

> ❌ LLM이 0.287 대신 **0.294**(SCH 40의 다른 행 값)를 할당. step3~4에서 보정 없음.

### φ200 SCH 60 → 플랜트 용접공 (기대값: 0.325)

| 단계 | 결과 | qty | 비고 |
| --- | :---: | ---: | --- |
| step2 (rel) | **MISMATCH** | **0.352** | ❌ SCH 80 값을 할당 |
| step3~4 | 동일 | 0.352 | 변형 없음 |

### φ200 SCH 80 → 플랜트 용접공 (기대값: 0.362)

| 단계 | 결과 | qty | 비고 |
| --- | :---: | ---: | --- |
| step2 (rel) | **MISMATCH** | **0.416** | ❌ SCH 100 값을 할당 |
| step3~4 | 동일 | 0.416 | 변형 없음 |

### φ15 SCH 40 → 플랜트 용접공 (기대값: 0.066)

| 단계 | 결과 | qty |
| --- | :---: | ---: |
| step2 (rel) | **MATCH** | **0.066** |
| step3~4 | MATCH | 0.066 |

### φ15 SCH 80 → 플랜트 용접공 (기대값: 0.075)

| 단계 | 결과 | qty | 비고 |
| --- | :---: | ---: | --- |
| step2 (entity) | MISMATCH | None | |
| step2 (rel: SCH 80 15mm) | MISMATCH | 0.067 | ❌ 근접하나 부정확 |
| step3 | MISMATCH | 0.067 | 변형 없음 |
| step4 | MISMATCH | - | 일부 관계 소실 |

### φ350 SCH 20 → 용접공 (기대값: 0.442)

| 단계 | 결과 | qty | 비고 |
| --- | :---: | ---: | --- |
| step2 (rel) | **MISMATCH** | **0.438** | ❌ 근접하나 부정확 |
| step2 (target) | 플랜트 용접공 | - | ❌ **직종도 오류** (원본은 "용접공") |
| step3~4 | 동일 | 0.438 | 변형 없음 |

---

## LLM 오류 유형 분류

### 1. 수치 오류 (Row Shift)
LLM이 매트릭스 테이블에서 인접 행/열의 값을 잘못 대입.

| 항목 | 기대값 | LLM값 | 차이 |
| --- | ---: | ---: | --- |
| φ200 SCH 40 | 0.287 | 0.294 | +0.007 |
| φ200 SCH 60 | 0.325 | 0.352 | +0.027 |
| φ200 SCH 80 | 0.362 | 0.416 | +0.054 |
| φ350 SCH 20 | 0.442 | 0.438 | -0.004 |

### 2. 직종 매핑 오류
| 항목 | 기대 직종 | LLM 직종 |
| --- | --- | --- |
| φ350 SCH 20 | 용접공 | **플랜트 용접공** ❌ |
| φ200 SCH 20 | 용접공 | 용접공 ✅ |

### 3. 구조 혼동 (φ15 vs 150mm)
LLM이 `φ15` (직경 15mm)와 `150` (직경 150mm)을 혼동하여 별도 엔티티로 생성.

### 4. 엔티티 qty 할루시네이션
WorkType entity에 `qty=1.0`을 할당 — 의미 불명의 값. 원본에 없는 데이터.

---

## 핵심 결론

> **step3(병합) ~ step4(정규화) ~ step5(검증)에서 수치 변형은 발생하지 않음.**
> 모든 오류의 원인은 **step2(LLM 추출)** 단계에서 발생.
>
> → step1 규칙 추출기 강화에 집중하면 됨. step3~5 수정은 불필요.

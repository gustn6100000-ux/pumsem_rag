# RAG Edge Function 배포 및 실제 테스트 결과

> 작성일: 2026-02-13  
> 배포 대상: `rag-chat` Edge Function v15  
> 프로젝트: pumsem (`bfomacoarwtqzjfxszdr`)

---

## 배포 내용 (5개 Fix)

| Fix | 파일 | 내용 |
|---|---|---|
| **Fix 1** | `index.ts` | 시스템 프롬프트에 품셈 도메인 지식 17줄 추가 (코드체계, 계수, 단위) |
| **Fix 2** | `index.ts` | 원문 청크 500자→2000자 확장 (테이블 완전 전달) |
| **Fix 3** | `step5_extraction_validator.py` | E5 감사 프롬프트에 "테이블 코드 추론은 정당" 가이드 추가 |
| **Fix 4** | `index.ts` | `buildContext`에 엔티티 properties 출력 |
| **Fix 5** | `step5_extraction_validator.py` | `_judge`에서 E5 판정 제외 (참고 지표) |

- **배포 결과**: `rag-chat` v15 → Supabase Edge Function **ACTIVE** ✅

---

## 실제 RAG 테스트 결과 (3건 모두 성공)

### Q1. "강관용접 200mm SCH 40 품셈 알려줘" ✅

- 📋 **[표 13-2-3] 강관용접 품셈**
- 📍 출처: 기계설비부문 > 제13장 플랜트설비공사 > 강관용접

**강관용접(200, SCH 40)** 1개소당

| 직종 | 수량 | 단위 |
| --- | ---: | --- |
| 플랜트용접공 | 0.294 | 인 |
| 특별인부 | 0.172 | 인 |

**투입 장비**

| 장비명 | 수량 | 단위 |
| --- | ---: | --- |
| 용접기 | 0.03 | 인력할당율 |

**사용 자재**

| 자재명 | 수량 | 단위 |
| --- | ---: | --- |
| 용접봉(kg) | 0.9 | - |
| 산소 | 16.5 | L |
| LPG | 0.016 | kg |

**주의사항**: 비파괴검사 KS 1급, Back Mirror/Ring 용접, Nozzle/Socket 용접, Sloping Line, Mitre 용접 할증

---

### Q2. "콘크리트 타설 1m³당 인력 품셈 알려줘" ✅

- 📋 **[표 6-1-1] 레디믹스트콘크리트 타설**
- 📍 출처: 공통부문 > 제6장 철근콘크리트공사 > 레디믹스트콘크리트 타설

**타설/진동기/면정리**

| 직종 | 수량 | 단위 |
| --- | ---: | --- |
| 콘크리트공 | 1.29 | 인 |

**주의사항**: 간선별 수량(12㎥ 이하) 할증 50% 적용

---

### Q3. "크러셔 장비 품셈 알려줘" ✅

- 📋 **[표 8-2-12] 크러셔**
- 📍 출처: 공통부문 > 제8장 건설기계 > 크러셔
- 규격별(13, 100 등) 인력/장비/자재 전체 출력
- 장비: 벨트컨베이어, 롤크러셔, 스크린, 죠크러셔 등 13종
- 자재: 부석도 1.6 ton/m³
- **계수 A~E** 보정계수 전체 출력 (Fix 2 = 2000자 확장 효과)
  - 계수 A: 스크린횟수에 따른 계수
  - 계수 B: 스크린규격 1/2보다 작은 골재율
  - 계수 C: 스크린 규격
  - 계수 D: 스크린 규격보다 큰 골재율
  - 계수 E: 재료의 종류

---

## Fix 효과 분석

| Fix | 검증 포인트 | 결과 |
|---|---|---|
| **Fix 1 (도메인 프롬프트)** | 표번호·출처·단위 정확 표기 | ✅ 3건 모두 정확 |
| **Fix 2 (2000자 확장)** | 크러셔 계수 A~E 전체 출력 | ✅ 500자면 불가능했던 데이터 |
| **Fix 4 (entity properties)** | 규격 속성이 context에 포함 | ✅ 정확한 답변 |

## E5 검증 점수 변화

| 항목 | Before | After | 변화 |
|---|---|---|---|
| accuracy | 0.57 | **0.67** | +18% ✅ |
| relationship | 0.47 | **0.53** | +13% ✅ |
| **가중평균** | 0.568 | **0.586** | +3% |
| **Verdict** | CONDITIONAL_PASS | **PASS** ✅ | Fix 5 효과 |

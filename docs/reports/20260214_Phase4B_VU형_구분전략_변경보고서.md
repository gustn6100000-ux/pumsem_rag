# Phase 4B: V형/U형 구분 전략 변경 상세 보고서

> **일시**: 2026-02-14 00:00 KST  
> **대상**: section `13-2-4` (강판 전기아크용접) — 124 WorkType

---

## 1. 원래 계획: `source_chunk` 기반 구분

구현계획서(4B-1)에서는 각 WorkType 엔티티가 `properties.source_chunk` 속성에 자신이 추출된 chunk ID를 갖고 있을 것으로 전제했습니다.

```
V형 chunks: C-0956-B ~ C-0956-L (11개)
U형 chunks: C-0956-M ~ C-0956-N (2개)

→ source_chunk = C-0956-B~L → V형
→ source_chunk = C-0956-M~N → U형
```

이 방식은 **1:1 chunk-entity 대응**으로 100% 정확한 구분이 가능한 이상적 전략이었습니다.

---

## 2. 실제 데이터: `source_chunk` 전부 null

```sql
SELECT count(*) FILTER (WHERE properties->>'source_chunk' IS NULL) as null_count
FROM graph_entities WHERE type = 'WorkType';
-- 결과: 4,733건 전부 null (0건도 값 없음)
```

**원인**: `step1_table_extractor.py`의 추출 로직이 엔티티 생성 시 `source_chunk`를 `properties`에 기록하지 않음. 이는 **파이프라인 설계 누락** (Phase 4C에서 수정 필요).

---

## 3. 대체 전략: 원본 PDF 구조 역추론

원본 PDF(13-2-4 강판 전기아크용접)의 두 테이블은 **항목명과 두께 범위가 미묘하게 다릅니다**:

```
┌───────────────────────────────────────────────┐
│ 1. 전기아크용접(V형)('93년 보완)              │
│    두께: 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,    │
│          13, 14, 15mm (총 13개)                │
│    항목:                                       │
│    ├─ 용접봉사용량(kg)  ← V형 고유 항목명      │
│    ├─ 인 력(인)         ← V형: 공백 있음       │
│    └─ 소요전력(kWh)     ← V형 고유 항목명      │
├───────────────────────────────────────────────┤
│ 2. 전기아크용접(U형)                           │
│    두께: 5, 6, 7, 8, 9, 10, 11, 12, 15, 16,   │
│          18, 20, 22, 24, 25, 26, 28, 30, 35,   │
│          40, 45, 50, 55, 60, 65, 70mm (총 26개)│
│    항목:                                       │
│    ├─ 용접봉소비량(kg)  ← U형 고유 항목명      │
│    ├─ 인력(인)          ← U형: 공백 없음       │
│    └─ 전력소비량(kWh)   ← U형 고유 항목명      │
└───────────────────────────────────────────────┘
```

---

## 4. 구분 로직 5단계

### 4-1. 확정적 구분 — 항목명 고유

| 패턴           | V형/U형 | 근거                           | 건수 |
| -------------- | ------- | ------------------------------ | ---- |
| `용접봉사용량` | **V형** | V형 테이블에만 존재하는 항목명 | 13   |
| `용접봉소비량` | **U형** | U형 테이블에만 존재하는 항목명 | 26   |
| `전력소비량`   | **U형** | U형 고유 (V형은 "소요전력")    | 8    |

→ 47건 확정 (이름만으로 100% 구분)

### 4-2. 조건부 구분 — 두께 범위

`소요전력`은 두 테이블 모두에 존재하나, V형은 두께 15mm까지만 데이터가 있습니다:

| 패턴                   | 두께    | V형/U형 | 건수 |
| ---------------------- | ------- | ------- | ---- |
| `소요전력` + 두께 ≤ 15 | 3~15mm  | **V형** | 13   |
| `소요전력` + 두께 ≥ 16 | 16~70mm | **U형** | 11   |

→ 24건 (두께 16 이상 소요전력 = 실질적으로 U형에서만 가능)

### 4-3. 추출 부산물 기반 — 공백 차이

PDF 레이아웃의 차이로 추출기가 V형 테이블의 "인력"을 공백 포함(`인 력`)으로, U형은 공백 없이(`인력`)으로 추출:

| 패턴                  | V형/U형 | 건수 |
| --------------------- | ------- | ---- |
| `인 력(인)` (공백 有) | **V형** | 13   |
| `인력(인)` (공백 無)  | **U형** | 19   |

→ 32건

### 4-4. 하향용접 — 두께 기반

V형은 두께 15mm에서만, U형은 20mm 이상에서 자세별 용접 데이터 존재:

| 패턴                            | 두께    | V형/U형 | 건수 |
| ------------------------------- | ------- | ------- | ---- |
| `하향양면/한면용접` + 두께 15   | 15mm    | **V형** | 2    |
| `하향양면/한면용접` + 두께 ≥ 16 | 20~70mm | **U형** | 19   |

→ 21건

### 커버리지 합산

```
V형: 13(사용량) + 13(소요전력≤15) + 13(인 력) + 2(하향15) = 41건
U형: 26(소비량) + 8(전력소비) + 11(소요전력≥16) + 19(인력) + 19(하향≥16) = 83건
합계: 41 + 83 = 124건 = 전체 WorkType 수 ✅
미태깅: 0건 ✅
```

---

## 5. 전략 비교

| 관점            | 원래 계획 (source_chunk)  | 실제 적용 (이름 패턴)                       |
| --------------- | ------------------------- | ------------------------------------------- |
| **정확도**      | 100% (1:1 대응)           | 99%+ (PDF 구조 역추론)                      |
| **근거**        | 추출 시 기록된 메타데이터 | 원본 PDF의 테이블 구조 차이                 |
| **잠재 위험**   | 없음                      | `인 력` vs `인력` 구분이 추출 부산물에 의존 |
| **적용 가능성** | ❌ 불가 (null)             | ✅ 성공                                      |
| **재현성**      | 재추출 후에도 유지        | 파이프라인 수정 시 공백 패턴 변경 가능      |

---

## 6. 후속 조치 (Phase 4C 반영 필요)

1. **`source_chunk` 기록 필수화**: 파이프라인에서 엔티티 생성 시 출처 chunk ID를 반드시 기록
2. **공백 정규화**: `인 력` → `인력` 통일 (현재는 구분 단서로 활용 중이나, 본질적으로는 정규화 대상)
3. **소제목 반영**: chunk 텍스트의 "1. 전기아크용접(V형)" 소제목을 엔티티명에 반영하면 `source_chunk` 없이도 확정 구분 가능

> **핵심 인사이트**: 추출 파이프라인의 "버그"(공백 차이)가 오히려 V/U형 구분의 단서가 되었습니다. 그러나 이는 **우연적 구분자**이므로, Phase 4C에서 구조적 해결이 필요합니다.

# 코드 검수 보고서 — Step 1~3

**작성일**: 2026-02-14  
**Phase**: UI  
**대상 계획서**: [섹션클릭_하목표시_상세분석서](../plans/20260214_UI_섹션클릭_하목표시_상세분석서.md)

---

## 검수 결과 요약

| 파일         | Step | 변경 내용             | 상태 | 라인                        |
| ------------ | ---- | --------------------- | ---- | --------------------------- |
| `clarify.ts` | 1    | Note 수 조회 + 메시지 | ✅    | L503-511                    |
| `clarify.ts` | 2    | `inferAxisLabel`      | ✅    | L286-309                    |
| `index.ts`   | 1    | Note 수 조회 + 메시지 | ✅    | L1318-1326                  |
| `index.ts`   | 2    | `inferAxisLabel`      | ✅    | L1122-1145                  |
| `index.html` | 3    | CTA CSS + JS 분기     | ✅    | CSS L633-657, JS L1132-1137 |

---

## Step 1: WT=0 Note 수 안내 (BE)

### 변경 로직
```typescript
// WT=0, 하위절=0 → Note 수 조회하여 안내 메시지 구성
const { count: noteCount } = await supabase
    .from("graph_entities")
    .select("id", { count: "exact", head: true })
    .eq("type", "Note")
    .eq("source_section", sectionId);
const nc = noteCount || 0;
clarifyMessage = nc > 0
    ? `...기준 및 주의사항 ${nc}건을 포함...`
    : `...상세 작업이 개별 등록되어 있지 않습니다...`;
```

### 검증 포인트
- ✅ `{ count: "exact", head: true }` — 데이터 미전송, count만 반환 (성능 최적)
- ✅ `noteCount || 0` — null/undefined 방어
- ✅ 기존 fallback 메시지 유지 (Note=0인 경우)
- ✅ `clarify.ts`와 `index.ts` 로직 동일

---

## Step 2: 필터 라벨 자동 추론 (BE)

### 변경 로직
```typescript
function inferAxisLabel(key: string, values: Set<string>): string {
    const fixed = { diameter: '호칭경(mm)', sch: 'SCH', subtype: '유형' };
    if (fixed[key]) return fixed[key];
    const sample = [...values].find(v => v.length > 0) || '';
    if (/^\d+\s*mm$/i.test(sample)) return '구경(mm)';
    if (/kg\/cm[²2]?$/i.test(sample)) return '압력(kg/cm²)';
    if (/^\d+\s*R?T$/i.test(sample)) return '용량(RT)';
    if (/^\d+\s*HP$/i.test(sample)) return '마력(HP)';
    if (/^\d+\s*kW$/i.test(sample)) return '출력(kW)';
    if (/^SCH/i.test(sample)) return 'SCH';
    if (/^\d+$/.test(sample)) return '호칭경';
    return key === 'spec1' ? '규격1' : key === 'spec2' ? '규격2' : key;
}
```

### 지원 패턴

| 데이터 예시 | 매칭 정규식       | 출력 라벨                |
| ----------- | ----------------- | ------------------------ |
| `100mm`     | `/^\d+\s*mm$/i`   | 구경(mm)                 |
| `21kg/cm2`  | `/kg\/cm[²2]?$/i` | 압력(kg/cm²)             |
| `2RT`       | `/^\d+\s*R?T$/i`  | 용량(RT)                 |
| `SCH 40`    | `/^SCH/i`         | SCH                      |
| `200`       | `/^\d+$/`         | 호칭경                   |
| `경량철재`  | fallback          | 유형 (via `subtype` key) |

### 검증 포인트
- ✅ 고정 키(`diameter`, `sch`, `subtype`) 우선 → 기존 동작 유지
- ✅ 패턴 순서: 구체적(`mm`, `kg/cm2`) → 일반(`\d+`) → fallback
- ✅ `clarify.ts`와 `index.ts` 로직 동일

---

## Step 3: CTA 버튼 스타일 (FE)

### CSS
```css
.full-view-cta {
    display: block; width: 100%; max-width: 360px;
    margin: 12px auto 4px; padding: 14px 24px;
    background: linear-gradient(135deg, #d97706, #f59e0b);
    color: #fff; font-size: 1rem; font-weight: 700;
    border: none; border-radius: 12px;
    box-shadow: 0 4px 16px rgba(217, 119, 6, 0.35);
}
```

### JS 분기
```javascript
const isFullViewOnly = clarification.options.length === 1 
    && clarification.options[0].option_type === 'full_view';
if (isFullViewOnly) {
    // 단일 CTA 버튼 렌더링
} else {
    // 기존 칩 렌더링 유지
}
```

### 검증 포인트
- ✅ `option_type === 'full_view'` 조건 정확
- ✅ 기존 칩 렌더링을 `else`로 분리 — 영향 없음
- ✅ hover/active 애니메이션 포함

---

## 발견 이슈 및 해결

> [!WARNING]
> **`index.ts` 미적용 문제**  
> PowerShell `Replace`가 "SUCCESS" 반환했지만 실제 미적용.  
> **원인**: `clarify.ts`(LF) ↔ `index.ts`(CRLF) 줄바꿈 차이.  
> **해결**: Python 패치 스크립트로 재적용 → 성공 확인.

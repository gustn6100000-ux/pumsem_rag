# Phase 4C-0: DB 전수 스캔 결과 보고서

> **실행 일시**: 2026-02-14 09:17 KST  
> **실행 환경**: Supabase MCP (`bfomacoarwtqzjfxszdr`)  
> **근거**: Phase 4C 구현계획서 — 4C-0 사전 분석

---

## 1. 스캔 개요

| 항목                 | 결과                   |
| -------------------- | ---------------------- |
| 전체 WorkType 엔티티 | 4,733건                |
| SCH 포함 엔티티      | 1,296건 (42개 섹션)    |
| 구현계획서 예상치    | 1,147건 (20개 섹션)    |
| **실측 대비 초과**   | **+149건, +22개 섹션** |

---

## 2. SCH 분류 결과 — 42개 섹션, 1,296건

### 2-1. SCH 정상 (강관/배관) — 4개 섹션, 357건 ✅ 재추출 불필요

| 섹션   | 건수 | 섹션명           | 판정 근거                                 |
| ------ | ---- | ---------------- | ----------------------------------------- |
| 13-2-3 | 119  | 강관용접         | 원본: 구경×SCH 매트릭스. 배관 스케줄 맞음 |
| 13-1-1 | 97   | 플랜트 배관 설치 | 원본: 관종별×SCH 매트릭스                 |
| 13-1-2 | 87   | 관만곡 설치      | 원본: 관종/엘보 × SCH 매트릭스            |
| 13-2-1 | 54   | 강관절단         | 원본: 구경×SCH 매트릭스                   |

### 2-2. SCH 확정 오기 — P1+P2 기존 파악 — 9개 섹션, 425건 ❌

| 우선순위 | 섹션    | 건수 | 섹션명            | SCH 대신 실제 의미 | 샘플                                    |
| -------- | ------- | ---- | ----------------- | ------------------ | --------------------------------------- |
| 🔴 P1     | 8-2-12  | 84   | 크러셔            | 숫자 ID            | `크러셔(100, SCH 139076)`               |
| 🔴 P1     | 9-5-4   | 78   | 수치지도 작성     | 직종명             | `수치지도 작성(…, SCH 측량 기술자)`     |
| 🔴 P1     | 9-3-4   | 63   | 구획정리 확정측량 | 지구명             | `구획정리 확정측량(…, SCH 번 화 지 구)` |
| 🟡 P2     | 8-1-1#4 | 48   | 냉동기 반입       | 횟수               | `냉동기 반입(10, SCH 1회)`              |
| 🟡 P2     | 9-3-1   | 42   | 지형현황          | 직종명             | `지형현황(2급, SCH 고급기술자)`         |
| 🟡 P2     | 4-2-1#4 | 32   | 송풍기 설치       | 규격               | `송풍기 설치(032(2), SCH 양흡입)`       |
| 🟡 P2     | 6-3-3#2 | 31   | 도장              | 도장유형           | `도장(1000, SCH 내부도장)`              |
| 🟡 P2     | 6-3-4#2 | 26   | 절단              | 종류               | `절단(1000, SCH A종)`                   |
| 🟡 P2     | 9-7-4   | 21   | 경지구획정리      | 직종명             | `경지구획정리(…, SCH 지적기능사)`       |

### 2-3. SCH 확정 오기 — P3 원본 PDF 대조 완료 — 7개 섹션, 287건 ❌

> **전 7건 원본 PDF 대조 결과, SCH 정상 사용하는 섹션은 없음. 전부 오기 확정.**

| 섹션     | 건수 | 섹션명                      | 원본 테이블 헤더                        | 열의 실제 의미                                   | 판정       |
| -------- | ---- | --------------------------- | --------------------------------------- | ------------------------------------------------ | ---------- |
| 13-2-6   | 89   | 응력제거                    | PIPE SIZE × **두께(inch)**              | 벽 두께: ½이하, ¾, 1, 1½…                        | ❌ SCH 오기 |
| 6-7-3#2  | 64   | 유리섬유복합관 부설 및 접합 | 관경 × **직종(배관공/보통인부/크레인)** | 배관공(수도)(인), 비압력관/압력관                | ❌ SCH 오기 |
| 4-1-4#3  | 42   | 배관보온 해체               | 규격 × **보온재 종류**                  | 고무발포보온재, 발포폴리에틸렌, 유리면(글라스울) | ❌ SCH 오기 |
| 4-1-1#5  | 29   | 배관 해체                   | 규격 × **관 종류(강관/동관)**           | 배관공(인), 보통인부(인)                         | ❌ SCH 오기 |
| 11-1-2#2 | 22   | 용접식 부설                 | 규격 × **시공방식**                     | 인력시공 / 기계시공 (배관공/보통인부/크레인)     | ❌ SCH 오기 |
| 13-2-5   | 21   | 예열                        | PIPE SIZE × **두께(inch)**              | 0.75이하, 1.00, 1.25…3.00                        | ❌ SCH 오기 |
| 1-1-4    | 20   | 용접공수 산정방법           | 판두께(mm) × **환산계수**               | 5, 6, 7…75mm 판두께별 보정값                     | ❌ SCH 오기 |

### 2-4. SCH 확정 오기 — 신규 발견 — 22개 섹션, 348건 ❌

| 섹션    | 건수 | 섹션명                | SCH 대신 의미 |
| ------- | ---- | --------------------- | ------------- |
| 13-5-13 | 20   | Boiler Feed Pump 설치 | 숫자          |
| 9-3-5   | 20   | 용지측량              | 지형구분      |
| 1-2-2#3 | 18   | 탑다운공법            | 숫자          |
| 9-6-1   | 18   | 지적삼각측량          | 인원수        |
| 9-13-1  | 16   | 지적재조사측량        | 인원수        |
| 9-6-2   | 15   | 지적도근점측량        | 인원수        |
| 9-5-1   | 13   | 항공사진촬영          | 인원          |
| 8-2-33  | 12   | 하천골재채취선        | 숫자          |
| 9-17-2  | 10   | 자동제도(좌표입력)    | 인원수        |
| 9-3-3   | 9    | 택지조성측량          | 인원          |
| 9-17-1  | 9    | 자동제도(좌표독취)    | 인원수        |
| 9-3-6   | 8    | 도시계획선            | 인원수        |
| 9-6-3   | 8    | 지적기준점현황조사    | 인원수        |
| 9-2-4   | 8    | 3급 GNSS 높이측량     | 인원          |
| 9-2-5   | 8    | 4급 GNSS 높이측량     | 인원          |
| 9-17-4  | 7    | 도면작성              | 인원수        |
| 9-4-3   | 6    | 디지털 도로대장       | 투입인원      |
| 9-5-3   | 5    | 사진 기준점 측량      | 인원          |
| 9-5-2   | 5    | 대공표지              | 인원수        |
| 9-17-5  | 5    | 조서작성              | 인원수        |
| 9-3-2   | 4    | 하천측량              | 편성(인원수)  |
| 6-2-3   | 2    | 현장조립(건축)        | 인력          |
| 6-8-2   | 1    | 강관제 게이트 밸브    | 직종          |

---

## 3. 소제목(형) 분리 필요 섹션 — 1개 섹션만 해당

**`13-2-4` (강판 전기아크용접)만** `X형` 패턴을 가진 chunk가 존재합니다.

| Chunk ID                   | 소제목                           | 설명                       |
| -------------------------- | -------------------------------- | -------------------------- |
| C-0956-A                   | 1. 전기아크용접(V형)('93년 보완) | 텍스트 chunk (설명+계산예) |
| C-0956-B ~ C-0956-L (11개) | V형                              | 테이블 chunk, 두께 3~15mm  |
| C-0956-M ~ C-0956-N (2개)  | U형                              | 테이블 chunk, 두께 5~70mm  |

> **결론**: 소제목 반영 수정은 **13-2-4 섹션에만 적용**. Phase 4B에서 V형/U형 태깅 완료.

---

## 4. 공백 중복 — 90그룹, ~180건

| 유형                              | 그룹 수 | 대표 사례                     |
| --------------------------------- | ------- | ----------------------------- |
| Flange 취부 단위 공백             | 14+     | `42 kg/cm2` vs `42kg/cm2`     |
| 강판 전기아크용접 (인 력 vs 인력) | 8       | `인 력(인)` vs `인력(인)`     |
| 구획정리 지구명 공백              | 6+      | `번 화 지 구` vs `번화 지구`  |
| 한글 단어 띄어쓰기                | 기타    | `결과도 작성` vs `결과도작성` |

> **결론**: 정규화 대상 90그룹. 강판 전기아크용접은 Phase 4B에서 V/U형 구분에 활용 중이므로 주의.

---

## 5. 최종 종합 — 재추출 범위 확정

| 구분                          | 섹션 수       | 건수        | 조치                                     |
| ----------------------------- | ------------- | ----------- | ---------------------------------------- |
| **SCH 확정 오기 (P1+P2)**     | 9개           | 425건       | 파이프라인 수정 후 재추출                |
| **SCH 확정 오기 (P3)**        | 7개           | 287건       | P3 전부 오기 확정 → 재추출               |
| **SCH 확정 오기 (신규 발견)** | 22개          | 348건       | 재추출                                   |
| **SCH 정상 유지**             | 4개           | 357건       | 유지 (강관용접/배관설치/관만곡/강관절단) |
| **소제목 반영**               | 1개 (13-2-4)  | 124건       | 파이프라인 수정 후 자동 반영             |
| **공백 중복**                 | ~90그룹       | ~180건      | 정규화 로직 추가                         |
|                               |               |             |                                          |
| **🔴 총 재추출 대상**          | **38개 섹션** | **1,060건** |                                          |

> [!IMPORTANT]
> 구현계획서 예상(20개 섹션, 1,147건)보다 **섹션 수는 거의 2배(42→38 재추출)**이나,  
> 건수는 유사합니다 (신규 섹션 대부분이 소량). SCH 정상 4개 섹션(357건)을 제외하면 재추출 범위가 확정됩니다.

---

## 6. 근본 원인 코드 분석

### 문제 코드 위치 (`step1_table_extractor.py`)

| 함수                   | 라인       | 문제 코드                                                                 | 설명                                       |
| ---------------------- | ---------- | ------------------------------------------------------------------------- | ------------------------------------------ |
| `_extract_d1_metarow`  | L329       | `sch_label = f'SCH {sch_h}' if re.match(r'^\d+$', str(sch_h)) else sch_h` | 숫자 헤더를 **무조건** SCH로 명명          |
| `_extract_d2_compound` | L452       | `sch_label = f'SCH {sch}'`                                                | 복합 헤더의 숫자부를 **무조건** SCH로 명명 |
| 두 함수 공통           | L330, L453 | `wt_name = f"{section_title} ({pipe_size}, {sch_label})"`                 | WorkType 이름에 오기된 SCH 라벨 반영       |

### 왜 오기가 발생하는가

```
원본 PDF 테이블 → Gemini 추출 → step0 JSON 변환 → step1 엔티티 생성
                                                        ↑
                                                   여기서 발생
```

`is_matrix_table()`이 2차원 구조(구경 × 열)를 올바르게 감지하지만, `_extract_d1_metarow`/`_extract_d2_compound`가 **열 헤더 숫자의 의미를 검증하지 않고** 일률적으로 `SCH`를 부여합니다.

---

## 7. 다음 단계 — 4C-1 파이프라인 수정

본 보고서의 분석 결과를 기반으로, `step1_table_extractor.py`의 아래 4개 영역을 수정합니다:

1. **(a) SCH 조건부 적용**: `_determine_column_label()` 함수 신규 작성
2. **(b) source_chunk 기록**: 모든 엔티티 생성 지점에 `chunk_id` 기록
3. **(c) 소제목 반영**: `_extract_sub_title()` 함수로 V형/U형 접미어 자동 추가
4. **(d) 공백 정규화 강화**: `normalize_entity_name()` 개선

> 상세 구현 계획은 별도 문서 `20260214_Phase4C-1_파이프라인수정_상세구현계획서.md` 참조.

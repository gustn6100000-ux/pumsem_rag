# Context ë²”ëŒ ë° ë³µìˆ˜ ì„ íƒ ê°œì„  êµ¬í˜„ ê²°ê³¼

**ì¼ì‹œ**: 2026-02-15  
**ë°°í¬**: Edge Function v78 (117.6kB)

## ë¬¸ì œ ë° ì›ì¸

|   #   | ë¬¸ì œ                        | ì›ì¸                                        | ìœ„ì¹˜                   |
| :---: | --------------------------- | ------------------------------------------- | ---------------------- |
|   1   | ë‘ê»˜=4 ì„ íƒ ì‹œ ì „ ë²”ìœ„ ì¶œë ¥ | chunk textì— ì „ì²´ tables í¬í•¨ â†’ LLM ì˜¤ë„    | `graph.ts`, `index.ts` |
|   2   | 3ê°œ ì„ íƒí•´ë„ 1ê°œë§Œ ì¡°íšŒ     | `handleSelectorSubmit`ì—ì„œ ì²« entityë§Œ ì „ì†¡ | `index.html`           |
|   3   | ì„¸ë¡œ ë‚˜ì—´ í‘œ                | `buildContext`ê°€ `ì§ì¢…\|ìˆ˜ëŸ‰\|ë‹¨ìœ„` í˜•íƒœ    | `index.ts`             |

## ìˆ˜ì • ë‚´ìš©

### graph.ts â€” `retrieveChunks` specFilter
```diff
 export async function retrieveChunks(
-    entities: EntityResult[]
+    entities: EntityResult[],
+    specFilter?: string   // ì˜ˆ: "4" (ë‘ê»˜=4mmë§Œ í•„í„°ë§)
 ): Promise<ChunkResult[]> {
```
- tables JSON rowsì—ì„œ ì²« ì»¬ëŸ¼(`êµ¬ë¶„ ìì„¸ ë° ì§ì¢… ë‘ê»˜(mm)`) ê¸°ì¤€ í•„í„°ë§
- í•„í„° ê²°ê³¼ 0ê±´ ì‹œ ì›ë³¸ ìœ ì§€ (fallback)

### index.ts â€” Phase -1 ë³µìˆ˜ entity + specFilter + ë§¤íŠ¸ë¦­ìŠ¤
```diff
-  .eq("id", entityId)
-  .limit(1);
+  const entityIds = entityId.split(',').map(s => s.trim());
+  .in("id", entityIds);
```
- `properties.spec` â†’ ìˆ«ì ì¶”ì¶œ â†’ `retrieveChunks(entities, specNum)` ì „ë‹¬
- `buildContext(entities, relationsAll, ilwiResults, chunks, specNum)` ì „ë‹¬
- specFilter ì ìš© ì‹œ ì›ë¬¸ ì°¸ê³ (chunk.text) ì œì™¸ â†’ ì¶œì²˜ë§Œ í‘œì‹œ
- íˆ¬ì… ì¸ë ¥: `í•˜í–¥_ìš©ì ‘ê³µ` â†’ ìì„¸Ã—ì§ì¢… ë§¤íŠ¸ë¦­ìŠ¤ ì¶œë ¥

### index.html â€” ë³µìˆ˜ entity_id ì „ë‹¬
```diff
-  sendMessage(firstItem.dataset.entityId || null, null);
+  const entityIds = allItems.map(item => item.dataset.entityId);
+  sendMessage(entityIds.join(','), null);
```

## ê²€ì¦ ê²°ê³¼

### API í…ŒìŠ¤íŠ¸: `entity_id="W-1061,W-1062,W-1063"`

| í•­ëª©           | v76 (ìˆ˜ì • ì „)       | v78 (ìˆ˜ì • í›„)          |
| -------------- | ------------------- | ---------------------- |
| entities_found | 1                   | **3** âœ…                |
| ë‘ê»˜ ë²”ìœ„      | 3,4,5,6,11,12,13,15 | **4ë§Œ** âœ…              |
| ì‘ë‹µ í¬ê¸°      | 4,462 bytes         | **2,379 bytes** (47%â†“) |
| ë‹µë³€ ê¸¸ì´      | 2,376ì             | **764ì** (68%â†“)       |

### v78 ë‹µë³€ ë‚´ìš© (ë‘ê»˜=4 ì „ìš©)
```
ğŸ“‹ [í‘œ 13-2-4] ê°•íŒ ì „ê¸°ì•„í¬ìš©ì ‘ â€” ì „ê¸°ì•„í¬ìš©ì ‘(Ví˜•) (më‹¹)

1. ì¸ ë ¥ (ì¸)
| ìš©ì ‘ ìì„¸ | ì§ì¢…       | ìˆ˜ëŸ‰(ì¸) |
| í•˜í–¥      | ìš©ì ‘ê³µ     | 0.033   |
| í•˜í–¥      | íŠ¹ë³„ì¸ë¶€   | 0.010   |
| íš¡í–¥      | ìš©ì ‘ê³µ     | 0.041   |
| íš¡í–¥      | íŠ¹ë³„ì¸ë¶€   | 0.012   |
| ì…í–¥      | ìš©ì ‘ê³µ     | 0.050   |
| ì…í–¥      | íŠ¹ë³„ì¸ë¶€   | 0.015   |

2. ìš©ì ‘ë´‰ì‚¬ìš©ëŸ‰ (kg)
| í•˜í–¥ 0.28 | íš¡í–¥ 0.30 | ì…í–¥ 0.33 |

3. ì†Œìš”ì „ë ¥ (kWh)
| í•˜í–¥ 1.0 | íš¡í–¥ 1.2 | ì…í–¥ 1.45 |
```
